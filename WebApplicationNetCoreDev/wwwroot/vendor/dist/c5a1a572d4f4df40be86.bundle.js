(self.webpackChunk_5_112_1332=self.webpackChunk_5_112_1332||[]).push([[673],{673:(t,e,i)=>{t.exports=function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}return i.m=t,i.c=e,i.p="",i(0)}({0:function(t,e,i){t.exports=i(892)},3:function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},881:function(t,e){t.exports=i(6758)},882:function(t,e){t.exports=i(8678)},883:function(t,e){t.exports=i(550)},892:function(t,e,i){var n,o,s;i(3),o=[i(881),i(894),i(895),i(896),i(897),i(893),i(882),i(883),i(898),i(899),i(900)],void 0===(s="function"==typeof(n=function(){!function(t,e){var i=kendo.dataviz,n=kendo.drawing,o=kendo.geometry,s=i.diagram,r=kendo.ui.Widget,a=kendo.Class,h=t.proxy,c=kendo.deepExtend,d=kendo._outerWidth,l=kendo._outerHeight,u=t.extend,p=kendo.data.HierarchicalDataSource,f=s.Canvas,_=s.Group,m=s.Rectangle,g=s.Circle,v=s.CompositeTransform,w=s.Rect,y=s.Path,C=s.DeleteShapeUnit,b=s.DeleteConnectionUnit,S=s.TextBlock,x=s.Image,T=s.Point,k=s.Intersect,D=s.ConnectionEditAdorner,I=s.UndoRedoService,M=s.ToolService,B=s.Selector,E=s.ResizingAdorner,R=s.ConnectorsAdorner,P=s.Cursors,O=s.Utils,z=kendo.Observable,A=s.ToBackUnit,L=s.ToFrontUnit,H=s.PolylineRouter,V=s.CascadingRouter,U=O.isUndefined,F=O.isDefined,N=n.util.defined,X=t.isArray,Y=kendo.isFunction,G=O.isString,q=t.isPlainObject,J=Math,W=".kendoDiagram",K="cascading",Z="itemBoundsChange",Q="change",j="click",$="error",tt="Auto",et=9007199254740992,it="select",nt="itemRotate",ot="pan",st="zoomStart",rt="zoomEnd",at="none",ht=Number.MAX_VALUE,ct=-Number.MAX_VALUE,dt="transformed",lt="rotated";s.DefaultConnectors=[{name:"Top"},{name:"Bottom"},{name:"Left"},{name:"Right"},{name:tt,position:function(t){return t.getPosition("center")}}];var ut={cancel:{text:"Cancel",imageClass:"k-i-cancel",className:"k-diagram-cancel",iconClass:"k-icon"},update:{text:"Update",imageClass:"k-i-checkmark",className:"k-diagram-update",iconClass:"k-icon"}};function pt(t){return t.options.name.toLowerCase()===tt.toLowerCase()}function ft(t,e){for(var i,n,o=et,s=0;s<e.length;s++)if(!pt(n=e[s])){var r=t.distanceTo(n.position());r<o&&(o=r,i=n)}return i}function _t(t,e){var i,n,o=[],s=t.drawingContainer().children,r=s.length;for(i=0;i<e.length;i++){n=e[i];for(var a=0;a<r;a++)if(s[a]==n.drawingContainer()){o.push(a);break}}return o}s.shapeDefaults=function(t){var e={type:"rectangle",path:"",autoSize:!0,visual:null,x:0,y:0,minWidth:20,minHeight:20,width:100,height:100,hover:{},editable:{connect:!0,tools:[]},connectors:s.DefaultConnectors,rotation:{angle:0}};return O.simpleExtend(e,t),e};var mt=z.extend({init:function(t){var e=this;e.dataItem=(t||{}).dataItem,z.fn.init.call(e),e.options=c({id:s.randomId()},e.options,t),e.isSelected=!1,e.visual=new _({id:e.options.id,autoSize:e.options.autoSize}),e.id=e.options.id,e._template()},options:{hover:{},cursor:P.grip,content:{align:"center middle"},selectable:!0,serializable:!0,enable:!0},_getCursor:function(t){return this.adorner?this.adorner._getCursor(t):this.options.cursor},visible:function(t){if(U(t))return this.visual.visible();this.visual.visible(t)},bounds:function(){},refresh:function(){this.visual.redraw()},position:function(t){this.options.x=t.x,this.options.y=t.y,this.visual.position(t)},toString:function(){return this.options.id},serialize:function(){var t=c({},{options:this.options});return this.dataItem&&(t.dataItem=this.dataItem.toString()),t},_content:function(t){if(t!==e){var i=this.options;s.Utils.isString(t)?i.content.text=t:c(i.content,t);var n=i.content;this._contentVisual?this._updateContentVisual(n):this._createContentVisual(n)}return this.options.content.text},_createContentVisual:function(t){t.text&&(this._contentVisual=new S(t),this._contentVisual._includeInBBox=!1,this.visual.append(this._contentVisual))},_updateContentVisual:function(t){this._contentVisual.redraw(t)},_hitTest:function(t){var e=this.bounds();return this.visible()&&e.contains(t)&&this.options.enable},_template:function(){var t=this;if(t.options.content.template){var e=t.dataItem||{},i=kendo.template(t.options.content.template,{paramName:"dataItem"});t.options.content.text=i(e)}},_canSelect:function(){return!1!==this.options.selectable},toJSON:function(){return{id:this.options.id}}}),gt=a.extend({init:function(t,e){this.options=c({},this.options,e),this.connections=[],this.shape=t},options:{width:7,height:7,fill:{color:"Yellow"},hover:{}},position:function(){return this.options.position?this.options.position(this.shape):this.shape.getPosition(this.options.name)},toJSON:function(){return{shapeId:this.shape.toString(),connector:this.options.name}}});gt.parse=function(t,e){for(var i=e.split(":"),n=i[0],o=i[1]||tt,s=0;s<t.shapes.length;s++){var r=t.shapes[s];if(r.options.id==n)return r.getConnector(o.trim())}};var vt=mt.extend({init:function(t,e){var i=this;mt.fn.init.call(i,t),this.diagram=e,this.updateOptionsFromModel(),t=i.options,i.connectors=[],i.type=t.type,i.createShapeVisual(),i.updateBounds(),i.content(i.content()),i._createConnectors()},options:s.shapeDefaults(),_setOptionsFromModel:function(t){var e=Ct(t||this.dataItem);this.options=c({},this.options,e),this.redrawVisual()},updateOptionsFromModel:function(t,e){if(this.diagram&&this.diagram._isEditable){var n=Ct(t||this.dataItem);if(t&&e)if(i.inArray(e,["x","y","width","height"])){var o=this.bounds();o[e]=t[e],this.bounds(o)}else this.options.visual?this._redrawVisual():n.type&&(this.options=c({},this.options,n),this._redrawVisual()),this.options.content&&(this._template(),this.content(this.options.content));else this.options=c({},this.options,n)}},_redrawVisual:function(){this.visual.clear(),this._contentVisual=null,this.options.dataItem=this.dataItem,this.createShapeVisual(),this.updateBounds()},redrawVisual:function(){this._redrawVisual(),this.options.content&&(this._template(),this.content(this.options.content))},updateModel:function(t){var e=this.diagram;if(e&&e._isEditable){var i=this._bounds,n=this.dataItem;n&&(e._suspendModelRefresh(),N(n.x)&&i.x!==n.x&&n.set("x",i.x),N(n.y)&&i.y!==n.y&&n.set("y",i.y),N(n.width)&&i.width!==n.width&&n.set("width",i.width),N(n.height)&&i.height!==n.height&&n.set("height",i.height),this.dataItem=n,e._resumeModelRefresh(),t&&e._syncShapeChanges())}},updateBounds:function(){var t=this.visual._measure(!0),e=this.options;this.bounds(new w(e.x,e.y,t.width,t.height)),this._rotate(),this._alignContent()},content:function(t){var e=this._content(t);return this._alignContent(),e},_alignContent:function(){var t=this.options.content||{},e=this._contentVisual;if(e&&t.align){var i=this.visual._measure(),n=new s.RectAlign(i),o=e.drawingElement.bbox(null),r=new w(0,0,o.width(),o.height()),a=n.align(r,t.align);e.position(a.topLeft())}},_createConnectors:function(){var t,e,i=this.options,n=i.connectors.length,o=i.connectorDefaults;for(e=0;e<n;e++)t=new gt(this,c({},o,i.connectors[e])),this.connectors.push(t)},bounds:function(t){var e;if(t)if(G(t))switch(t){case dt:e=this._transformedBounds();break;case"absolute":e=this._transformedBounds();var i=this.diagram._pan;e.x+=i.x,e.y+=i.y;break;case lt:e=this._rotatedBounds();break;default:e=this._bounds}else this._setBounds(t),this._triggerBoundsChange(),this.diagram&&this.diagram._layouting||this.refreshConnections();else e=this._bounds;return e},_setBounds:function(t){var e=this.options,i=t.topLeft(),n=e.x=i.x,o=e.y=i.y,s=e.width=J.max(t.width,e.minWidth),r=e.height=J.max(t.height,e.minHeight);this._bounds=new w(n,o,s,r),this.visual.redraw({x:n,y:o,width:s,height:r})},position:function(t){if(!t)return this._bounds.topLeft();this.bounds(new w(t.x,t.y,this._bounds.width,this._bounds.height))},clone:function(){var t=this.serialize();return t.options.id=s.randomId(),this.diagram&&this.diagram._isEditable&&N(this.dataItem)&&(t.options.dataItem=Et(this.dataItem)),new vt(t.options)},select:function(t){var e,i,n=this.diagram;if(U(t)&&(t=!0),this._canSelect()&&this.isSelected!=t)return e=[],i=[],this.isSelected=t,this.isSelected?(n._selectedItems.push(this),e.push(this)):(O.remove(n._selectedItems,this),i.push(this)),n._internalSelection||n._selectionChanged(e,i),!0},rotate:function(t,i,n){var o=this.visual.rotate();if(t!==e){!1!==n&&this.diagram&&this.diagram.undoRedoService&&t!==o.angle&&this.diagram.undoRedoService.add(new s.RotateUnit(this.diagram._resizingAdorner,[this],[o.angle]),!1);var r,a,h=this.bounds(),c=new T(h.width/2,h.height/2);i&&(r=t-o.angle,a=h.center().rotate(i,360-r).minus(c),this._rotationOffset=this._rotationOffset.plus(a.minus(h.topLeft())),this.position(a)),this.visual.rotate(t,c),this.options.rotation.angle=t,this.diagram&&this.diagram._connectorsAdorner&&this.diagram._connectorsAdorner.refresh(),this.refreshConnections(),this.diagram&&this.diagram.trigger(nt,{item:this})}return o},connections:function(t){var e,i,n,o,s=[];for(e=0;e<this.connectors.length;e++)for(o=this.connectors[e].connections,i=0;i<o.length;i++)if(n=o[i],"out"==t){var r=n.source();r.shape&&r.shape==this&&s.push(n)}else if("in"==t){var a=n.target();a.shape&&a.shape==this&&s.push(n)}else s.push(n);return s},refreshConnections:function(){t.each(this.connections(),(function(){this.refresh()}))},getConnector:function(t){var e,i;if(!G(t))return t instanceof T?ft(t,this.connectors):this.connectors.length?this.connectors[0]:null;for(t=t.toLocaleLowerCase(),e=0;e<this.connectors.length;e++)if((i=this.connectors[e]).options.name.toLocaleLowerCase()==t)return i},getPosition:function(t){var e=this.bounds(),i=t.charAt(0).toLowerCase()+t.slice(1);return Y(e[i])?this._transformPoint(e[i]()):e.center()},redraw:function(t){if(t){var e,i=this.options;this.shapeVisual.redraw(this._visualOptions(t)),this._diffNumericOptions(t,["width","height","x","y"])&&(this.bounds(new w(i.x,i.y,i.width,i.height)),e=!0),t.connectors&&(i.connectors=t.connectors,this._updateConnectors()),i=c(i,t),(t.rotation||e)&&this._rotate(),i.content&&this.content(i.content)}},_updateConnectors:function(){var t,e,i,n=this.connections();this.connectors=[],this._createConnectors();for(var o=0;o<n.length;o++)e=(t=n[o]).source(),i=t.target(),e.shape&&e.shape===this?t.source(this.getConnector(e.options.name)||null):i.shape&&i.shape===this&&t.target(this.getConnector(i.options.name)||null),t.updateModel()},_diffNumericOptions:s.diffNumericOptions,_visualOptions:function(t){return{data:t.path,source:t.source,hover:t.hover,fill:t.fill,stroke:t.stroke}},_triggerBoundsChange:function(){this.diagram&&this.diagram.trigger(Z,{item:this,bounds:this._bounds.clone()})},_transformPoint:function(t){var e=this.rotate(),i=this.bounds().topLeft();return e.angle&&t.rotate(e.center().plus(i),360-e.angle),t},_transformedBounds:function(){var t=this.bounds(),e=t.topLeft(),i=t.bottomRight();return w.fromPoints(this.diagram.modelToView(e),this.diagram.modelToView(i))},_rotatedBounds:function(){var t=this.bounds().rotatedBounds(this.rotate().angle),e=t.topLeft(),i=t.bottomRight();return w.fromPoints(e,i)},_rotate:function(){var t=this.options.rotation;t&&t.angle&&this.rotate(t.angle),this._rotationOffset=new T},_hover:function(t){var e=this.options,i=e.hover,n=e.stroke,o=e.fill;t&&F(i.stroke)&&(n=c({},n,i.stroke)),t&&F(i.fill)&&(o=i.fill),this.shapeVisual.redraw({stroke:n,fill:o}),e.editable&&e.editable.connect&&this.diagram._showConnectors(this,t)},_hitTest:function(t){if(this.visible()){var e,i=this.bounds(),n=this.rotate().angle;if(t.isEmpty&&!t.isEmpty())return k.rects(t,i,n||0);if(e=t.clone().rotate(i.center(),n),i.contains(e))return this}},toJSON:function(){return{shapeId:this.options.id}},createShapeVisual:function(){var t,e,i,n=this.options,o=this._visualOptions(n),s=n.visual,r=(n.type+"").toLocaleLowerCase();o.width=n.width,o.height=n.height,Y(s)?t=s.call(this,n):o.data?(e=t=new y(o),0===(i=e.drawingContainer().clippedBBox(null)).origin.x&&0===i.origin.y||e.position(-i.origin.x,-i.origin.y)):t="rectangle"==r?new m(o):"circle"==r?new g(o):"text"==r?new S(o):"image"==r?new x(o):new y(o),this.shapeVisual=t,this.visual.append(this.shapeVisual)}}),wt=mt.extend({init:function(t,e,i){var n=this;mt.fn.init.call(n,i),this.updateOptionsFromModel(),this._initRouter(),n.path=new s.Polyline(n.options),n.path.fill("transparent"),n.visual.append(n.path),n._sourcePoint=n._targetPoint=new T,n._setSource(t),n._setTarget(e),n.content(n.options.content),n.definers=[],N(i)&&i.points&&n.points(i.points)},options:{hover:{stroke:{}},startCap:at,endCap:at,points:[],selectable:!0,fromConnector:tt,toConnector:tt},_setOptionsFromModel:function(t){this.updateOptionsFromModel(t||this.dataItem)},updateOptionsFromModel:function(t){if(this.diagram&&this.diagram._isEditable){var e=this.diagram._dataMap,i=(s=t||this.dataItem,r={},N((s=s||{}).text)&&null!==s.text&&(r.content=s.text),N(s.type)&&null!==s.type&&(r.type=s.type),N(s.from)&&null!==s.from&&(r.from=s.from),N(s.fromConnector)&&null!==s.fromConnector&&(r.fromConnector=s.fromConnector),N(s.fromX)&&null!==s.fromX&&(r.fromX=s.fromX),N(s.fromY)&&null!==s.fromY&&(r.fromY=s.fromY),N(s.to)&&null!==s.to&&(r.to=s.to),N(s.toConnector)&&null!==s.toConnector&&(r.toConnector=s.toConnector),N(s.toX)&&null!==s.toX&&(r.toX=s.toX),N(s.toY)&&null!==s.toY&&(r.toY=s.toY),r);if(t){if(N(i.from)){var n=e[i.from];n&&N(i.fromConnector)&&(n=n.getConnector(i.fromConnector)),this.source(n)}else N(i.fromX)&&N(i.fromY)&&this.source(new T(i.fromX,i.fromY));if(N(i.to)){var o=e[i.to];o&&N(i.toConnector)&&(o=o.getConnector(i.toConnector)),this.target(o)}else N(i.toX)&&N(i.toY)&&this.target(new T(i.toX,i.toY));N(i.type)&&this.type()!==i.type&&(this.points([]),this.type(i.type)),this.dataItem=t,this._template(),this.redraw(this.options)}else this.options=c({},i,this.options)}var s,r},updateModel:function(t){if(this.diagram&&this.diagram._isEditable&&this.diagram.connectionsDataSource){var e=this.diagram.connectionsDataSource.getByUid(this.dataItem.uid);e&&(this.diagram._suspendModelRefresh(),N(this.options.fromX)&&null!==this.options.fromX?(Ot("from",e),Ot("fromConnector",e),e.set("fromX",this.options.fromX),e.set("fromY",this.options.fromY)):(e.set("from",this.options.from),N(e.fromConnector)&&e.set("fromConnector",this.sourceConnector?this.sourceConnector.options.name:null),Ot("fromX",e),Ot("fromY",e)),N(this.options.toX)&&null!==this.options.toX?(Ot("to",e),Ot("toConnector",e),e.set("toX",this.options.toX),e.set("toY",this.options.toY)):(e.set("to",this.options.to),N(e.toConnector)&&e.set("toConnector",this.targetConnector?this.targetConnector.options.name:null),Ot("toX",e),Ot("toY",e)),N(this.options.type)&&N(e.type)&&e.set("type",this.options.type),this.dataItem=e,this.diagram._resumeModelRefresh(),t&&this.diagram._syncConnectionChanges())}},sourcePoint:function(){return this._resolvedSourceConnector?this._resolvedSourceConnector.position():this._sourcePoint},_setSource:function(t){var i,n=t instanceof vt,o=this.options.fromConnector||tt;n&&!t.getConnector(o)||(t!==e&&(this.from=t),this._removeFromSourceConnector(),null===t?this.sourceConnector&&(this._sourcePoint=(this._resolvedSourceConnector||this.sourceConnector).position(),this._clearSourceConnector(),this._setFromOptions(null,this._sourcePoint)):t instanceof gt?((i=t.shape.dataItem)&&this._setFromOptions(i.id),this.sourceConnector=t,this.sourceConnector.connections.push(this)):t instanceof T?(this._setFromOptions(null,t),this._sourcePoint=t,this.sourceConnector&&this._clearSourceConnector()):n&&((i=t.dataItem)&&this._setFromOptions(i.id),this.sourceConnector=t.getConnector(o),this.sourceConnector.connections.push(this)))},source:function(t,e){return F(t)&&(e&&this.diagram&&this.diagram.undoRedoService.addCompositeItem(new s.ConnectionEditUnit(this,t)),this._setSource(t),this.refresh()),this.sourceConnector?this.sourceConnector:this._sourcePoint},_setFromOptions:function(t,e){this.options.from=t,e?(this.options.fromX=e.x,this.options.fromY=e.y):(this.options.fromX=null,this.options.fromY=null)},sourceDefiner:function(t){if(!t)return this._sourceDefiner||(this._sourceDefiner=new s.PathDefiner(this.sourcePoint(),null,null)),this._sourceDefiner;if(!(t instanceof s.PathDefiner))throw"The sourceDefiner needs to be a PathDefiner.";t.left=null,this._sourceDefiner=t,this.source(t.point)},targetPoint:function(){return this._resolvedTargetConnector?this._resolvedTargetConnector.position():this._targetPoint},_setTarget:function(t){var i,n=t instanceof vt,o=this.options.toConnector||tt;n&&!t.getConnector(o)||(t!==e&&(this.to=t),this._removeFromTargetConnector(),null===t?this.targetConnector&&(this._targetPoint=(this._resolvedTargetConnector||this.targetConnector).position(),this._clearTargetConnector(),this._setToOptions(null,this._targetPoint)):t instanceof gt?((i=t.shape.dataItem)&&this._setToOptions(i.id),this.targetConnector=t,this.targetConnector.connections.push(this)):t instanceof T?(this._setToOptions(null,t),this._targetPoint=t,this.targetConnector&&this._clearTargetConnector()):n&&((i=t.dataItem)&&this._setToOptions(i.id),this.targetConnector=t.getConnector(o),this.targetConnector.connections.push(this)))},target:function(t,i){return F(t)&&(i&&this.diagram&&this.diagram.undoRedoService.addCompositeItem(new s.ConnectionEditUnit(this,e,t)),this._setTarget(t),this.refresh()),this.targetConnector?this.targetConnector:this._targetPoint},_setToOptions:function(t,e){this.options.to=t,e?(this.options.toX=e.x,this.options.toY=e.y):(this.options.toX=null,this.options.toY=null)},targetDefiner:function(t){if(!t)return this._targetDefiner||(this._targetDefiner=new s.PathDefiner(this.targetPoint(),null,null)),this._targetDefiner;if(!(t instanceof s.PathDefiner))throw"The sourceDefiner needs to be a PathDefiner.";t.right=null,this._targetDefiner=t,this.target(t.point)},_updateConnectors:function(){this._updateConnector(this.source(),"source"),this._updateConnector(this.target(),"target")},_updateConnector:function(t,e){var i=this,n=i.diagram;if(t instanceof gt&&!n.getShapeById(t.shape.id)){var o=t.shape.dataItem,s=t.options.name,r=function(){var r=n._dataMap[o.id];t=r.getConnector(s),i[e](t,!1),i.updateModel()};if(n._dataMap[o.id])r();else{var a=n._inactiveShapeItems.getByUid(o.uid);a&&n._deferredConnectionUpdates.push(a.onActivate(r))}}else i[e](t,!1)},content:function(t){var e=this._content(t);return N(t)&&this._alignContent(),e},_createContentVisual:function(t){var e;return Y(t.visual)?e=t.visual.call(this,t):t.text&&(e=new S(t)),e&&(this._contentVisual=e,e._includeInBBox=!1,this.visual.append(e)),e},_updateContentVisual:function(t){Y(t.visual)?(this.visual.remove(this._contentVisual),this._createContentVisual(t)):this._contentVisual.redraw(t)},_alignContent:function(){if(this._contentVisual){for(var t=5,e=this.allPoints(),i=J.floor(e.length/2),o=i-1;o>0&&e[o].equals(e[i]);)o--,i++;var s,r=e[i],a=e[o],h=this._contentVisual._measure(),c=h.width,d=h.height,l=e.length%2==0,u=a.distanceTo(r);if(l&&e.length>2&&u>0&&(a.y===r.y&&u<c||a.x===r.x&&u<d)&&(l=!1,t=0),l){var p=n.util.deg(J.atan2(r.y-a.y,r.x-a.x));s=new T((r.x-a.x)/2+a.x,(r.y-a.y)/2+a.y),90===J.abs(p)?(s.x+=t,s.y-=d/2):p%180==0?(s.x-=c/2,s.y-=d+t):p<-90||0<p&&p<90?s.y-=d:(p<0||p>90)&&(s.x-=c,s.y-=d)}else{var f=J.floor(e.length/2);s=e[f].clone(),a=e[f-1],r=e[f+1];var _=a.x<=s.x&&r.x<=s.x?t:-h.width-t,m=a.y<=s.y&&r.y<=s.y?t:-h.height-t;s.x+=_,s.y+=m}this._contentVisual.position(s)}},select:function(t){var i,n,o=this.diagram;if(this._canSelect()&&this.isSelected!==t)return this.isSelected=t,i=[],n=[],this.isSelected?(this.adorner=new D(this,this.options.selection),o._adorn(this.adorner,!0),o._selectedItems.push(this),i.push(this)):this.adorner&&(o._adorn(this.adorner,!1),O.remove(o._selectedItems,this),this.adorner=e,n.push(this)),this.adorner&&this.adorner.refresh(),o._internalSelection||o._selectionChanged(i,n),!0},bounds:function(t){if(!t||G(t))return this._bounds;this._bounds=t},type:function(t){var e=this.options;if(!t)return e.type;t!==e.type&&(e.type=t,this._initRouter(),this.refresh())},_initRouter:function(){var t=(this.options.type||"").toLowerCase();this._router=t==K?new V(this):new H(this)},points:function(t){if(!t){var e=[];if(F(this.definers))for(var i=0;i<this.definers.length;i++)e.push(this.definers[i].point);return e}this.definers=[];for(var n=0;n<t.length;n++){var o=t[n];if(o instanceof s.Point)this.definers.push(new s.PathDefiner(o));else{if(!o.hasOwnProperty("x")||!o.hasOwnProperty("y"))throw"A Connection point needs to be a Point or an object with x and y properties.";this.definers.push(new s.PathDefiner(new T(o.x,o.y)))}}},allPoints:function(){var t=[this.sourcePoint()];if(this.definers)for(var e=0;e<this.definers.length;e++)t.push(this.definers[e].point);return t.push(this.targetPoint()),t},refresh:function(){this._resolveConnectors(),this._refreshPath(),this._alignContent(),this.adorner&&this.adorner.refresh()},_resolveConnectors:function(){var t,e,i,n,o=this,s=o.source(),r=o.target();s instanceof T?t=s:s instanceof gt&&(i=pt(s)?s.shape.connectors:[s]),r instanceof T?e=r:r instanceof gt&&(n=pt(r)?r.shape.connectors:[r]),t?n&&(o._resolvedTargetConnector=ft(t,n)):i&&(e?o._resolvedSourceConnector=ft(e,i):n&&this._resolveAutoConnectors(i,n))},_resolveAutoConnectors:function(t,e){var i,n,o,s,r,a,h,c,d,l,u,p=et,f=et;for(d=0;d<t.length;d++)if(!pt(h=t[d]))for(o=h.position(),l=0;l<e.length;l++)pt(c=e[l])||(s=c.position(),(u=J.round(o.distanceTo(s)))<p&&this.diagram&&this._testRoutePoints(o,s,h,c)&&(p=u,i=h,n=c),u<f&&(r=h,a=c,f=u));i&&(r=i,a=n),this._resolvedSourceConnector=r,this._resolvedTargetConnector=a},_testRoutePoints:function(t,e,i,n){var o=this._router,s=!0;if(o instanceof V){var r,a,h,c,d=o.routePoints(t,e,i,n);c=this._getRouteExclude(t,e,i.shape,n.shape),d.unshift(t),d.push(e);for(var l=1;l<d.length;l++)if(r=d[l-1],a=d[l],(h=new w(J.min(r.x,a.x),J.min(r.y,a.y),J.abs(r.x-a.x),J.abs(r.y-a.y))).width>0&&(h.x++,h.width-=2),h.height>0&&(h.y++,h.height-=2),!h.isEmpty()&&this.diagram._shapesQuadTree.hitTestRect(h,c)){s=!1;break}}return s},_getRouteExclude:function(t,e,i,n){var o=[];return this._isPointInsideShape(t,i)&&o.push(i),this._isPointInsideShape(e,n)&&o.push(n),o},_isPointInsideShape:function(t,e){var i,n,o,s=e.bounds(),r=e.rotate().angle,a=s.x,h=s.y;return n=(i=t.clone().rotate(s.center(),r)).x,o=i.y,n>a&&n<a+s.width&&o>h&&o<h+s.height},redraw:function(t){if(t){this.options=c({},this.options,t);var e=this.options.points;N(e)&&e.length>0&&(this.points(e),this._refreshPath()),(t&&t.content||t.text)&&this.content(t.content),this.path.redraw({fill:t.fill,stroke:t.stroke,startCap:t.startCap,endCap:t.endCap})}},clone:function(){var t=this.serialize();return this.diagram&&this.diagram._isEditable&&N(this.dataItem)&&(t.options.dataItem=Et(this.dataItem)),new wt(this.from,this.to,t.options)},serialize:function(){var t=this.from.toJSON?this.from.toJSON:this.from.toString(),e=this.to.toJSON?this.to.toJSON:this.to.toString(),i=c({},{options:this.options,from:t,to:e});return N(this.dataItem)&&(i.dataItem=this.dataItem.toString()),i.options.points=this.points(),i},_hitTest:function(t){if(this.visible()){var e=new T(t.x,t.y),i=this.sourcePoint(),n=this.targetPoint();if(t.isEmpty&&!t.isEmpty()&&t.contains(i)&&t.contains(n))return this;if(this._router.hitTest(e))return this}},_hover:function(t){var e=(this.options.stroke||{}).color;t&&F(this.options.hover.stroke.color)&&(e=this.options.hover.stroke.color),this.path.redraw({stroke:{color:e}})},_refreshPath:function(){N(this.path)&&(this._drawPath(),this.bounds(this._router.getBounds()))},_drawPath:function(){this._router&&this._router.route();var t=this.sourcePoint(),e=this.targetPoint(),i=this.points();this.path.redraw({points:[t].concat(i,[e])})},_clearSourceConnector:function(){this.sourceConnector=e,this._resolvedSourceConnector=e},_clearTargetConnector:function(){this.targetConnector=e,this._resolvedTargetConnector=e},_removeFromSourceConnector:function(){this.sourceConnector&&O.remove(this.sourceConnector.connections,this)},_removeFromTargetConnector:function(){this.targetConnector&&O.remove(this.targetConnector.connections,this)},toJSON:function(){var t,e=this;return{from:e.from&&e.from.toJSON?e.from.toJSON():{x:(t=e._sourcePoint).x,y:t.y},to:e.to&&e.to.toJSON?e.to.toJSON():{x:(t=e._targetPoint).x,y:t.y}}}}),yt=r.extend({init:function(t,e){var i=this;kendo.destroy(t),r.fn.init.call(i,t,e),i._initTheme(),i._initElements(),i._extendLayoutOptions(i.options),i._initDefaults(e),i._interactionDefaults(),i._initCanvas(),i.mainLayer=new _({id:"main-layer"}),i.canvas.append(i.mainLayer),i._shapesQuadTree=new Bt(i),i._pan=new T,i._adorners=[],i.adornerLayer=new _({id:"adorner-layer"}),i.canvas.append(i.adornerLayer),i._createHandlers(),i._initialize(),i._resizingAdorner=new E(i,{editable:i.options.editable}),i._connectorsAdorner=new R(i),i._adorn(i._resizingAdorner,!0),i._adorn(i._connectorsAdorner,!0),i.selector=new B(i),i._clipboard=[],i.pauseMouseHandlers=!1,i._fetchFreshData(),i._createGlobalToolBar(),i._createOptionElements(),i.zoom(i.options.zoom),i.canvas.draw()},options:{name:"Diagram",theme:"default",layout:"",zoomRate:.1,zoom:1,zoomMin:0,zoomMax:2,dataSource:{},draggable:!0,template:"",autoBind:!0,editable:{rotate:{},resize:{},text:!0,tools:[],drag:{snap:{size:10,angle:10}},remove:!0},pannable:{},selectable:{key:"none"},tooltip:{enabled:!0,format:"{0}"},copy:{enabled:!0,offsetX:20,offsetY:20},shapeDefaults:s.shapeDefaults({undoable:!0}),connectionDefaults:{editable:{tools:[]},type:K},shapes:[],connections:[]},events:[rt,st,ot,it,nt,Z,Q,j,"mouseEnter","mouseLeave","toolBarClick","save","cancel","edit","remove","add","dataBound","dragStart","drag","dragEnd"],items:function(){return t()},_createGlobalToolBar:function(){var t=this.options.editable;if(t){var e=t.tools;!this._isEditable||!1===e||e&&0!==e.length||(e=["createShape","undo","redo","rotateClockwise","rotateAnticlockwise"]),e&&e.length&&(this.toolBar=new bt(this,{tools:e||{},click:h(this._toolBarClick,this),modal:!1}),this.toolBar.element.css({textAlign:"left"}),this.element.prepend(this.toolBar.element),this._resize())}},createShape:function(){if(this.editor&&this.editor.end()||!this.editor){var t=this.dataSource,e=(t.view()||[]).length,i=Pt(t,{}),n=this._createShape(i,{});this.trigger("add",{shape:n})||(t.insert(e,i),this._inactiveShapeItems.getByUid(i.uid).element=n,this.edit(n))}},_createShape:function(t,e){return(e=c({},this.options.shapeDefaults,e)).dataItem=t,new vt(e,this)},createConnection:function(){if(this.editor&&this.editor.end()||!this.editor){var t=this.connectionsDataSource,e=(t.view()||[]).length,i=Pt(t,{}),n=this._createConnection(i);this.trigger("add",{connection:n})||(this._connectionsDataMap[i.uid]=n,t.insert(e,i),this.addConnection(n,!1),this.edit(n))}},_createConnection:function(t,e,i){var n=c({},this.options.connectionDefaults);return n.dataItem=t,new wt(e||new T,i||new T,n)},editModel:function(t,e){var i,n;this.cancelEdit();var o=this.options.editable;if("shape"==e)i=o.shapeEditors,n=o.shapeTemplate;else{if("connection"!=e)return;var s=h(Tt,this);i=c({},{from:s,to:s},o.connectionEditors),n=o.connectionTemplate}this.editor=new xt(this.element,{update:h(this._update,this),cancel:h(this._cancel,this),model:t,type:e,target:this,editors:i,template:n}),this.trigger("edit",this._editArgs())},edit:function(t){if(t.dataItem){var e=t instanceof vt?"shape":"connection";this.editModel(t.dataItem,e)}},cancelEdit:function(){this.editor&&(this._getEditDataSource().cancelChanges(this.editor.model),this._destroyEditor())},saveEdit:function(){this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())&&this._getEditDataSource().sync()},_update:function(){this.editor&&this.editor.end()&&!this.trigger("save",this._editArgs())&&(this._getEditDataSource().sync(),this._destroyEditor())},_cancel:function(){if(this.editor&&!this.trigger("cancel",this._editArgs())){var t=this.editor.model;this._getEditDataSource().cancelChanges(t);var e=this._connectionsDataMap[t.uid]||this._dataMap[t.id];e&&e._setOptionsFromModel(t),this._destroyEditor()}},_getEditDataSource:function(){return"shape"===this.editor.options.type?this.dataSource:this.connectionsDataSource},_editArgs:function(){var t={container:this.editor.wrapper};return t[this.editor.options.type]=this.editor.model,t},_destroyEditor:function(){this.editor&&(this.editor.close(),this.editor=null)},_initElements:function(){this.wrapper=this.element.empty().css("position","relative").attr("tabindex",0).addClass("k-widget k-diagram"),this.scrollable=t("<div />").appendTo(this.element)},_initDefaults:function(t){var e=this.options,i=e.editable,n=e.shapeDefaults,o=e.connectionDefaults,s=(t||{}).shapeDefaults;!1===i?(n.editable=!1,o.editable=!1):(zt(i,n.editable,["drag","remove","connect"]),zt(i,o.editable,["drag","remove"])),s&&s.connectors&&(e.shapeDefaults.connectors=s.connectors)},_interactionDefaults:function(){var t=this.options,e=t.selectable,i=t.pannable,n=kendo.support.mobileOS;e&&!N(e.multiple)&&(t.selectable=c({multiple:!n},t.selectable)),i&&!N(i.key)&&(t.pannable=c({key:n?"none":"ctrl"},t.pannable))},_initCanvas:function(){var e=t("<div class='k-layer'></div>").appendTo(this.scrollable)[0],i=this.viewport();this.canvas=new f(e,{width:i.width||600,height:i.height||600})},_createHandlers:function(){var t=this;t.element.on("DOMMouseScroll.kendoDiagram mousewheel.kendoDiagram",h(t._wheel,t)).on("keydown"+W,h(t._keydown,t)),t._userEvents=new kendo.UserEvents(this.scrollable,{multiTouch:!0,fastTap:!0,tap:h(t._tap,t),start:h(t._dragStart,t),move:h(t._drag,t),end:h(t._dragEnd,t),gesturestart:h(t._gestureStart,t),gesturechange:h(t._gestureChange,t),gestureend:h(t._gestureEnd,t),doubleTap:h(t._doubleTap,t),supportDoubleTap:!0}),t.toolService=new M(t),this.scrollable.on("mouseover"+W,h(t._mouseover,t)).on("mouseout"+W,h(t._mouseout,t)).on("mousemove"+W,h(t._mouseMove,t)).on("mousedown"+W,h(t._mouseDown,t)).on("mouseup"+W,h(t._mouseUp,t)),this._syncHandler=h(t._syncChanges,t),t._resizeHandler=h(t.resize,t,!1),kendo.onResize(t._resizeHandler),this.bind(st,h(t._destroyToolBar,t)),this.bind(ot,h(t._destroyToolBar,t))},_dragStart:function(t){this._pauseMouseHandlers=!0;var e=this._eventPositions(t,!0),i=t.event;this.toolService.start(e,this._meta(i))&&(this._destroyToolBar(),i.preventDefault())},_drag:function(t){var e=this._eventPositions(t),i=t.event;this.toolService.move(e,this._meta(i))&&i.preventDefault()},_dragEnd:function(t){this._pauseMouseHandlers=!1;var e=this._eventPositions(t),i=t.event;this.toolService.end(e,this._meta(i))&&(this._createToolBar(),i.preventDefault())},_mouseMove:function(t){if(!this._pauseMouseHandlers){var e=this._eventPositions(t);this.toolService._updateHoveredItem(e),this.toolService._updateCursor(e)}},_mouseDown:function(){this._pauseMouseHandlers=!0},_mouseUp:function(){this._pauseMouseHandlers=!1},_tap:function(t){var e=this.toolService,i=this.options.selectable,n=this._eventPositions(t),o=this.focus();if(e._updateHoveredItem(n),e.hoveredItem){var s=e.hoveredItem;if(this.trigger("click",{item:s,point:n,meta:this._meta(t.event)}),i&&!1!==s.options.selectable){var r=!1!==i.multiple,a=kendo.support.mobileOS||this._meta(t.event).ctrlKey;s.isSelected?a?(this._destroyToolBar(),s.select(!1)):this._createToolBar(o):(this._destroyToolBar(),this.select(s,{addToSelection:r&&a}),this._createToolBar(o))}}else i&&(this._destroyToolBar(),this.deselect())},_keydown:function(t){this.toolService.keyDown(t.keyCode,this._meta(t))&&t.preventDefault()},_wheel:function(t){var e=function(t){var e=t.originalEvent,i=0;return e.wheelDelta?i=(i=-e.wheelDelta/40)>0?J.ceil(i):J.floor(i):e.detail&&(i=e.detail),i}(t),i=this._eventPositions(t),n=c(this._meta(t),{delta:e});this.toolService.wheel(i,n)&&t.preventDefault()},_meta:function(t){return{ctrlKey:t.ctrlKey,metaKey:t.metaKey,altKey:t.altKey,shiftKey:t.shiftKey,type:t.type}},_eventPositions:function(t,e){var i;if(t.touch){var n=e?"startLocation":"location";i=new T(t.x[n],t.y[n])}else{var o=t.originalEvent;i=new T(o.pageX,o.pageY)}return this.documentToModel(i)},_gestureStart:function(t){this._destroyToolBar(),this.scroller.disable();var e=this.documentToModel(new T(t.center.x,t.center.y)),i={point:e,zoom:this.zoom()};this.trigger(st,i)||(this._gesture=t,this._initialCenter=e)},_gestureChange:function(t){var e=this._gesture,i=this._initialCenter,n=this.documentToView(new T(t.center.x,t.center.y)),o=t.distance/e.distance,s=this._zoom,r=!1;J.abs(o-1)>=.05&&(this._zoom=s=this._getValidZoom(s*o),this.options.zoom=s,this._gesture=t,r=!0);var a=i.times(s),h=n.minus(a);(r||this._pan.distanceTo(h)>=5)&&(this._panTransform(h),this._updateAdorners()),t.preventDefault()},_doubleTap:function(t){var e=this,i=this._eventPositions(t),n=e.options,o=n.zoomRate,s=e.zoom()+o,r={point:i,meta:this._meta(t),zoom:s};e.trigger(st,r)||(s=kendo.dataviz.round(Math.max(n.zoomMin,Math.min(n.zoomMax,s)),2),r.zoom=s,e.zoom(s,r),e.trigger(rt,r))},_gestureEnd:function(){!1!==this.options.pannable&&this.scroller.enable(),this.trigger(rt,{point:this._initialCenter,zoom:this.zoom()})},_resize:function(){var t=this.viewport();this.canvas&&this.canvas.size(t),this.scrollable&&this.toolBar&&this.scrollable.height(t.height)},_mouseover:function(t){var e=t.target._kendoNode;e&&e.srcElement._hover&&e.srcElement._hover(!0,e.srcElement)},_mouseout:function(t){var e=t.target._kendoNode;e&&e.srcElement._hover&&e.srcElement._hover(!1,e.srcElement)},_initTheme:function(){var t,e=this,n=((e.options||{}).theme||"").toLowerCase(),o=i.ui.themes||{};t=-1!=i.SASS_THEMES.indexOf(n)?i.autoTheme().diagram:(o[n]||{}).diagram,e.options=c({},t,e.options),!0===e.options.editable&&c(e.options,{editable:(t||{}).editable})},_createOptionElements:function(){var t=this.options,e=t.shapes.length;e&&this._createShapes(),t.connections.length&&this._createConnections(),e&&t.layout&&this.layout(t.layout)},_createShapes:function(){var t,e,i=this.options.shapes;for(e=0;e<i.length;e++)t=i[e],this.addShape(t)},_createConnections:function(){var t,e,i,n,o=this,s=o.options,r=s.connectionDefaults,a=s.connections;for(n=0;n<a.length;n++)t=a[n],e=o._findConnectionTarget(t.from),i=o._findConnectionTarget(t.to),o.connect(e,i,c({},r,t))},_findConnectionTarget:function(t){var e,i=G(t=t||{})?t:t.shapeId||t.id;return i?(e=this.getShapeById(i),t.connector&&(e=e.getConnector(t.connector))):e=new T(t.x||0,t.y||0),e},destroy:function(){var t=this;r.fn.destroy.call(t),this._userEvents&&this._userEvents.destroy(),kendo.unbindResize(t._resizeHandler),t.clear(),t.element.off(W),t.scroller.wrapper.off(W),t.canvas.destroy(!0),t.canvas=e,t._destroyEditor(),t.destroyScroller(),t._destroyGlobalToolBar(),t._destroyToolBar()},destroyScroller:function(){var t=this.scroller;t&&(t.destroy(),t.element.remove(),this.scroller=null)},save:function(){var t,e,i,n={shapes:[],connections:[]};for(t=0;t<this.shapes.length;t++)(i=this.shapes[t]).options.serializable&&n.shapes.push(i.options);for(t=0;t<this.connections.length;t++)e=this.connections[t],n.connections.push(c({},e.options,e.toJSON()));return n},focus:function(){if(!this.element.is(kendo._activeElement())){var t,e=this.element,i=e[0],n=[],o=[],s=document.documentElement;do{(i=i.parentNode).scrollHeight>i.clientHeight&&(n.push(i),o.push(i.scrollTop))}while(i!=s);for(e.focus(),t=0;t<n.length;t++)n[t].scrollTop=o[t];return!0}},load:function(t){this.clear(),this.setOptions(t),this._createShapes(),this._createConnections()},setOptions:function(t){c(this.options,t)},clear:function(){var t=this;t.select(!1),t.mainLayer.clear(),t._shapesQuadTree.clear(),t._initialize()},connect:function(t,e,i){var n;if(this.connectionsDataSource&&this._isEditable){var o=this.connectionsDataSource.add({});(n=this._connectionsDataMap[o.uid]).source(t),n.target(e),n.redraw(i),n.updateModel()}else n=new wt(t,e,c({},this.options.connectionDefaults,i)),this.addConnection(n);return n},connected:function(t,e){for(var i=0;i<this.connections.length;i++){var n=this.connections[i];if(n.from==t&&n.to==e)return!0}return!1},addConnection:function(t,e){return!1!==e&&this.undoRedoService.add(new s.AddConnectionUnit(t,this),!1),t.diagram=this,t._setOptionsFromModel(),t.refresh(),this.mainLayer.append(t.visual),this.connections.push(t),this.trigger(Q,{added:[t],removed:[]}),t},_addConnection:function(t,e){var i,n=this.connectionsDataSource;if(n&&this._isEditable){if(i=Pt(n,Et(t.dataItem)),t.dataItem=i,t.updateModel(),!this.trigger("add",{connection:t}))return this._connectionsDataMap[i.uid]=t,n.add(i),this.addConnection(t,e),t._updateConnectors(),t}else if(!this.trigger("add",{connection:t}))return this.addConnection(t,e),t._updateConnectors(),t},addShape:function(t,e){var i,n=this.options.shapeDefaults;if(t instanceof vt)i=t;else{if(t instanceof kendo.Class)return;n=c({},n,t||{}),i=new vt(n,this)}return!1!==e&&this.undoRedoService.add(new s.AddShapeUnit(i,this),!1),this.shapes.push(i),i.diagram!==this&&(this._shapesQuadTree.insert(i),i.diagram=this),this.mainLayer.append(i.visual),this.trigger(Q,{added:[i],removed:[]}),i},_addShape:function(t,e){var i,n=this.dataSource;if(n&&this._isEditable){if(i=Pt(n,Et(t.dataItem)),t.dataItem=i,t.updateModel(),!this.trigger("add",{shape:t})){this.dataSource.add(i);var o=this._inactiveShapeItems.getByUid(i.uid);return o.element=t,o.undoable=e,t}}else if(!this.trigger("add",{shape:t}))return this.addShape(t,e)},remove:function(t,e){var i,n=Rt(t=X(t)?t.slice(0):[t]),o=n.shapes,s=n.connections;for(N(e)||(e=!0),e&&this.undoRedoService.begin(),this._suspendModelRefresh(),i=o.length-1;i>=0;i--)this._removeItem(o[i],e,s);for(i=s.length-1;i>=0;i--)this._removeItem(s[i],e);this._resumeModelRefresh(),e&&this.undoRedoService.commit(!1),this.trigger(Q,{added:[],removed:t})},_removeShapeDataItem:function(t){this._isEditable&&(this.dataSource.remove(t.dataItem),delete this._dataMap[t.dataItem.id])},_removeConnectionDataItem:function(t){this._isEditable&&(this.connectionsDataSource.remove(t.dataItem),delete this._connectionsDataMap[t.dataItem.uid])},_triggerRemove:function(t){for(var e,i,n,o=[],s=0;s<t.length;s++)n=(e=t[s]).options.editable,i=e instanceof vt?{shape:e}:{connection:e},n&&!1!==n.remove&&!this.trigger("remove",i)&&o.push(e);return o},undo:function(){this.undoRedoService.undo()},redo:function(){this.undoRedoService.redo()},select:function(t,e){if(!F(t))return this._selectedItems;var i,n,o=[],s=[];for((e=c({addToSelection:!1},e)).addToSelection||this.deselect(),this._internalSelection=!0,t instanceof Array?o=t:t instanceof mt&&(o=[t]),i=0;i<o.length;i++)(n=o[i]).select(!0)&&s.push(n);this._selectionChanged(s,[]),this._internalSelection=!1},selectAll:function(){this.select(this.shapes.concat(this.connections))},selectArea:function(t){var e,i,n;this._internalSelection=!0;var o=[];if(t instanceof w)for(i=this.shapes.concat(this.connections),e=0;e<i.length;e++)n=i[e],t&&!n._hitTest(t)||!n.options.enable||n.select(!0)&&o.push(n);this._selectionChanged(o,[]),this._internalSelection=!1},deselect:function(t){this._internalSelection=!0;var e,i,n=[],o=[];for(t instanceof Array?o=t:t instanceof mt?o.push(t):F(t)||(o=this._selectedItems.slice(0)),i=0;i<o.length;i++)(e=o[i]).select(!1)&&n.push(e);this._selectionChanged([],n),this._internalSelection=!1},toFront:function(t,e){t||(t=this._selectedItems.slice());var i,n=this._getDiagramItems(t);if(!N(e)||e){i=_t(this.mainLayer,n.visuals);var o=new L(this,t,i);this.undoRedoService.add(o)}else this.mainLayer.toFront(n.visuals),this._fixOrdering(n,!0)},toBack:function(t,e){t||(t=this._selectedItems.slice());var i,n=this._getDiagramItems(t);if(!N(e)||e){i=_t(this.mainLayer,n.visuals);var o=new A(this,t,i);this.undoRedoService.add(o)}else this.mainLayer.toBack(n.visuals),this._fixOrdering(n,!1)},bringIntoView:function(t,e){var i,n,o,r,a=this.viewport(),h=new s.RectAlign(a);0!==a.width&&0!==a.height&&("none"==(e=c({animate:!1,align:"center middle"},e)).align&&(e.align="center middle"),t instanceof mt?n=t.bounds(dt):X(t)?n=this.boundingBox(t):t instanceof w&&(n=t.clone()),o=n.clone(),n.zoom(this._zoom),(n.width>a.width||n.height>a.height)&&(this._zoom=this._getValidZoom(J.min(a.width/o.width,a.height/o.height)),n=o.clone().zoom(this._zoom)),this._zoomMainLayer(),i=n.clone(),h.align(n,e.align),r=n.topLeft().minus(i.topLeft()),this.pan(r.times(-1),e.animate))},alignShapes:function(t){U(t)&&(t="Left");var e,i,n,o=this.select();if(0!==o.length){switch(t.toLowerCase()){case"left":case"top":e=ht;break;case"right":case"bottom":e=ct}for(n=0;n<o.length;n++)if((i=o[n])instanceof vt)switch(t.toLowerCase()){case"left":e=J.min(e,i.options.x);break;case"top":e=J.min(e,i.options.y);break;case"right":e=J.max(e,i.options.x);break;case"bottom":e=J.max(e,i.options.y)}var r=[],a=[];for(n=0;n<o.length;n++)if((i=o[n])instanceof vt)switch(a.push(i),r.push(i.bounds()),t.toLowerCase()){case"left":case"right":i.position(new T(e,i.options.y));break;case"top":case"bottom":i.position(new T(i.options.x,e))}var h=new s.TransformUnit(a,r);this.undoRedoService.add(h,!1)}},zoom:function(t,e){if(t){var i=e?e.point:new s.Point(0,0);if(t=this._zoom=this._getValidZoom(t),!U(i)){var n=(i=new s.Point(J.round(i.x),J.round(i.y))).times(t),o=this.modelToView(i).minus(n);this._storePan(new s.Point(J.round(o.x),J.round(o.y)))}e&&(e.zoom=t),this._panTransform(),this.canvas.surface.hideTooltip(),this._updateAdorners()}return this._zoom},_getPan:function(t){return this.canvas.translate||(t=t.plus(this._pan)),t},pan:function(t,e){if(!(t instanceof T))return this._pan.times(-1);var i=this,n=i.scroller;t=(t=i._getPan(t)).times(-1),e?n.animatedScrollTo(t.x,t.y,(function(){i._updateAdorners()})):(n.scrollTo(t.x,t.y),i._updateAdorners())},viewport:function(){var t=this.element,e=t.width(),i=t.height();return this.toolBar&&(i-=l(this.toolBar.element)),new w(0,0,e,i)},copy:function(){if(this.options.copy.enabled){this._clipboard=[],this._copyOffset=1;for(var t=0;t<this._selectedItems.length;t++){var e=this._selectedItems[t];this._clipboard.push(e)}}},cut:function(){if(this.options.copy.enabled){this._clipboard=[],this._copyOffset=0;for(var t=0;t<this._selectedItems.length;t++){var e=this._selectedItems[t];this._clipboard.push(e)}this.remove(this._clipboard,!0)}},paste:function(){if(this._clipboard.length>0){var t,e,i,n={},o=Rt(this._clipboard),s=o.connections,r=o.shapes,a={x:this._copyOffset*this.options.copy.offsetX,y:this._copyOffset*this.options.copy.offsetY};for(this.deselect(),i=0;i<r.length;i++)e=(t=r[i]).clone(),n[t.id]=e,e.position(new T(t.options.x+a.x,t.options.y+a.y)),e.diagram=this,(e=this._addShape(e))&&e.select();for(i=0;i<s.length;i++)t=s[i],(e=this._addConnection(t.clone()))&&(this._updateCopiedConnection(e,t,"source",n,a),this._updateCopiedConnection(e,t,"target",n,a),e.select(!0),e.updateModel());this._syncChanges(),this._copyOffset+=1}},_updateCopiedConnection:function(t,e,i,n,o){var s,r,a,h=e[i](),c=this;h instanceof gt&&n[h.shape.id]?(a=n[h.shape.id],c.getShapeById(a.id)?t[i](a.getConnector(h.options.name)):(r=c._inactiveShapeItems.getByUid(a.dataItem.uid))&&(s=function(e){a=c._dataMap[e.id],t[i](a.getConnector(h.options.name)),t.updateModel()},c._deferredConnectionUpdates.push(r.onActivate(s)))):t[i](new T(e[i+"Point"]().x+o.x,e[i+"Point"]().y+o.y))},boundingBox:function(t,e){var i,n=w.empty(),o=F(t)?this._getDiagramItems(t):{shapes:this.shapes};if(o.shapes.length>0){var s=o.shapes[0];n=s.bounds(lt);for(var r=1;r<o.shapes.length;r++)i=(s=o.shapes[r]).bounds(lt),!0===e&&(i.x-=s._rotationOffset.x,i.y-=s._rotationOffset.y),n=n.union(i)}return n},_containerOffset:function(){var t=this.element.offset();return this.toolBar&&(t.top+=l(this.toolBar.element)),t},documentToView:function(t){var e=this._containerOffset();return new T(t.x-e.left,t.y-e.top)},viewToDocument:function(t){var e=this._containerOffset();return new T(t.x+e.left,t.y+e.top)},viewToModel:function(t){return this._transformWithMatrix(t,this._matrixInvert)},modelToView:function(t){return this._transformWithMatrix(t,this._matrix)},modelToLayer:function(t){return this._transformWithMatrix(t,this._layerMatrix)},layerToModel:function(t){return this._transformWithMatrix(t,this._layerMatrixInvert)},documentToModel:function(t){var e=this.documentToView(t);return this.canvas.translate||(e.x=e.x+this.scroller.scrollLeft,e.y=e.y+this.scroller.scrollTop),this.viewToModel(e)},modelToDocument:function(t){return this.viewToDocument(this.modelToView(t))},_transformWithMatrix:function(t,e){var i=t;if(t instanceof T)e&&(i=e.apply(t));else{var n=this._transformWithMatrix(t.topLeft(),e),o=this._transformWithMatrix(t.bottomRight(),e);i=w.fromPoints(n,o)}return i},setDataSource:function(t){this.options.dataSource=t,this._dataSource(),this.options.autoBind&&this.dataSource.fetch()},setConnectionsDataSource:function(t){this.options.connectionsDataSource=t,this._connectionDataSource(),this.options.autoBind&&this.connectionsDataSource.fetch()},layout:function(t){var e,i;switch(this._layouting=!0,U(t)&&(t=this.options.layout),(e=U(t)||U(t.type)?"Tree":t.type).toLowerCase()){case"tree":i=new s.TreeLayout(this);break;case"layered":i=new s.LayeredLayout(this);break;case"forcedirected":case"force":case"spring":case"springembedder":i=new s.SpringLayout(this);break;default:throw"Layout algorithm '"+e+"' is not supported."}var n=new s.LayoutState(this),o=i.layout(t);if(o){var r=new s.LayoutUndoUnit(n,o,t?t.animate:null);this.undoRedoService.add(r)}this._layouting=!1,this._redrawConnections()},getShapeById:function(t){var e;return(e=O.first(this.shapes,(function(e){return e.visual.id===t})))?e:e=O.first(this.connections,(function(e){return e.visual.id===t}))},getShapeByModelId:function(t){return this._isEditable?this._dataMap[t]:O.first(this.shapes,(function(e){return(e.dataItem||{}).id===t}))},getShapeByModelUid:function(t){return this._isEditable?O.first(this.shapes,(function(e){return(e.dataItem||{}).uid===t})):this._dataMap[t]},getConnectionByModelId:function(t){var e;return this.connectionsDataSource&&(e=O.first(this.connections,(function(e){return(e.dataItem||{}).id===t}))),e},getConnectionByModelUid:function(t){var e;return this.connectionsDataSource&&(e=this._connectionsDataMap[t]),e},_extendLayoutOptions:function(t){t.layout&&(t.layout=c({},s.LayoutBase.fn.defaultOptions||{},t.layout))},_selectionChanged:function(t,e){(t.length||e.length)&&this.trigger(it,{selected:t,deselected:e})},_getValidZoom:function(t){return J.min(J.max(t,this.options.zoomMin),this.options.zoomMax)},_panTransform:function(t){var e=this,i=t||e._pan;e.canvas.translate?(e.scroller.scrollTo(i.x,i.y),e._zoomMainLayer()):(e._storePan(i),e._transformMainLayer())},_finishPan:function(){this.trigger(ot,{total:this._pan,delta:Number.NaN})},_storePan:function(t){this._pan=t,this._storeViewMatrix()},_zoomMainLayer:function(){var t=this._zoom,e=new v(0,0,t,t);e.render(this.mainLayer),this._storeLayerMatrix(e),this._storeViewMatrix()},_transformMainLayer:function(){var t=this._pan,e=this._zoom,i=new v(t.x,t.y,e,e);i.render(this.mainLayer),this._storeLayerMatrix(i),this._storeViewMatrix()},_storeLayerMatrix:function(t){this._layerMatrix=t.toMatrix(),this._layerMatrixInvert=t.invert().toMatrix()},_storeViewMatrix:function(){var t=this._pan,e=this._zoom,i=new v(t.x,t.y,e,e);this._matrix=i.toMatrix(),this._matrixInvert=i.invert().toMatrix()},_toIndex:function(t,e){var i=this._getDiagramItems(t);this.mainLayer.toIndex(i.visuals,e),this._fixOrdering(i,!1)},_fixOrdering:function(t,e){var i,n,o=e?this.shapes.length-1:0,s=e?this.connections.length-1:0;for(i=0;i<t.shapes.length;i++)n=t.shapes[i],O.remove(this.shapes,n),O.insert(this.shapes,n,o);for(i=0;i<t.cons.length;i++)n=t.cons[i],O.remove(this.connections,n),O.insert(this.connections,n,s)},_getDiagramItems:function(t){var e,i={},n=t;for(i.visuals=[],i.shapes=[],i.cons=[],t?X(t)||(n=[t]):n=this._selectedItems.slice(),e=0;e<n.length;e++){var o=n[e];o instanceof vt?(i.shapes.push(o),i.visuals.push(o.visual)):o instanceof wt&&(i.cons.push(o),i.visuals.push(o.visual))}return i},_removeItem:function(t,e,i){t.select(!1),t instanceof vt?(this._removeShapeDataItem(t),this._removeShape(t,e,i)):t instanceof wt&&(this._removeConnectionDataItem(t),this._removeConnection(t,e)),this.mainLayer.remove(t.visual)},_removeShape:function(t,e,n){var o,s,r,a=[],h=[];for(this.toolService._removeHover(),e&&this.undoRedoService.addCompositeItem(new C(t)),O.remove(this.shapes,t),this._shapesQuadTree.remove(t),o=0;o<t.connectors.length;o++){r=t.connectors[o];for(var c=0;c<r.connections.length;c++)s=r.connections[c],n&&i.inArray(s,n)||(s.sourceConnector==r?a.push(s):s.targetConnector==r&&h.push(s))}for(o=0;o<a.length;o++)a[o].source(null,e),a[o].updateModel();for(o=0;o<h.length;o++)h[o].target(null,e),h[o].updateModel()},_removeConnection:function(t,e){t.sourceConnector&&O.remove(t.sourceConnector.connections,t),t.targetConnector&&O.remove(t.targetConnector.connections,t),e&&this.undoRedoService.addCompositeItem(new b(t)),O.remove(this.connections,t)},_removeDataItems:function(t,e){var i,n,o,s;for(t=X(t)?t:[t];t.length;)if(i=t.shift(),(o=this._dataMap[i.uid])&&(this._removeShapeConnections(o),this._removeItem(o,!1),delete this._dataMap[i.uid],e&&i.hasChildren&&i.loaded()))for(n=i.children.data(),s=0;s<n.length;s++)t.push(n[s])},_removeShapeConnections:function(t){var e,i=t.connections();if(i)for(e=0;e<i.length;e++)this._removeItem(i[e],!1)},_addDataItem:function(t,e){if(N(t)){var i=this._dataMap[t.id];if(i)return i;var n=c({},this.options.shapeDefaults);return n.dataItem=t,i=new vt(n,this),this.addShape(i,!1!==e),this._dataMap[t.id]=i,i}},_addDataItemByUid:function(t){if(N(t)){var e=this._dataMap[t.uid];if(e)return e;var i=c({},this.options.shapeDefaults);return i.dataItem=t,e=new vt(i,this),this.addShape(e),this._dataMap[t.uid]=e,e}},_addDataItems:function(t,e){var i,n,o,s;for(n=0;n<t.length;n++)i=t[n],o=this._addDataItemByUid(i),(s=this._addDataItemByUid(e))&&!this.connected(s,o)&&this.connect(s,o)},_refreshSource:function(t){var e,i,n=this,o=t.node,s=t.action,r=t.items,a=n.options;if(t.field)for(e=0;e<r.length;e++)this._dataMap[r[e].uid]&&this._dataMap[r[e].uid].redrawVisual();else{if("remove"==s)this._removeDataItems(t.items,!0);else for(s&&"itemloaded"!==s||this._bindingRoots||(this._bindingRoots=!0,i=!0),s||o||n.clear(),this._addDataItems(r,o),e=0;e<r.length;e++)r[e].load();a.layout&&(i||"remove"==s||"add"==s)&&n.layout(a.layout),i&&(this.trigger("dataBound"),this._bindingRoots=!1)}},_addItem:function(t){t instanceof vt?this.addShape(t):t instanceof wt&&this.addConnection(t)},_createToolBar:function(t){var e=this.toolService.diagram;if(!this.singleToolBar&&1===e.select().length){var i=e.select()[0];if(i&&!1!==i.options.editable){var n=i.options.editable,o=n.tools;if(this._isEditable&&0===o.length&&(i instanceof vt?o=["edit","rotateClockwise","rotateAnticlockwise"]:i instanceof wt&&(o=["edit"]),n&&!1!==n.remove&&o.push("delete")),o&&o.length){var s;this.singleToolBar=new bt(e,{tools:o,click:h(this._toolBarClick,this),modal:!0,popupZIndex:parseInt(e.element.closest(".k-window").css("zIndex"),10)+10});var r=d(this.singleToolBar._popup.element),a=l(this.singleToolBar._popup.element);if(i instanceof vt){var c=this.modelToView(i.bounds(lt));s=new T(c.x,c.y).minus(new T((r-c.width)/2,a+20))}else if(i instanceof wt){var u=this.modelToView(i.bounds());s=new T(u.x,u.y).minus(new T((r-u.width-20)/2,a+20))}s?(this.canvas.translate||(s=s.minus(new T(this.scroller.scrollLeft,this.scroller.scrollTop))),s=this.viewToDocument(s),s=new T(J.max(s.x,0),J.max(s.y,0)),this.singleToolBar.showAt(s),t&&this.singleToolBar._popup.one("close",At)):this._destroyToolBar()}}}},_toolBarClick:function(t){this.trigger("toolBarClick",t),this._destroyToolBar()},_normalizePointZoom:function(t){return t.times(1/this.zoom())},_initialize:function(){this.shapes=[],this._selectedItems=[],this.connections=[],this._dataMap={},this._connectionsDataMap={},this._inactiveShapeItems=new Dt,this._deferredConnectionUpdates=[],this.undoRedoService=new I({undone:this._syncHandler,redone:this._syncHandler}),this.id=s.randomId()},_fetchFreshData:function(){var t=this;t._dataSource(),t._isEditable&&t._connectionDataSource(),t.options.autoBind&&(t._isEditable?(this._loadingShapes=!0,this._loadingConnections=!0,t.dataSource.fetch(),t.connectionsDataSource.fetch()):t.dataSource.fetch())},_dataSource:function(){if(N(this.options.connectionsDataSource)){this._isEditable=!0;var t=this.options.dataSource||{},e=X(t)?{data:t}:t;this.dataSource&&this._shapesRefreshHandler?this.dataSource.unbind("change",this._shapesRefreshHandler).unbind("requestStart",this._shapesRequestStartHandler).unbind("error",this._shapesErrorHandler):(this._shapesRefreshHandler=h(this._refreshShapes,this),this._shapesRequestStartHandler=h(this._shapesRequestStart,this),this._shapesErrorHandler=h(this._error,this)),this.dataSource=kendo.data.DataSource.create(e).bind("change",this._shapesRefreshHandler).bind("requestStart",this._shapesRequestStartHandler).bind("error",this._shapesErrorHandler)}else this._treeDataSource(),this._isEditable=!1},_connectionDataSource:function(){var t=this.options.connectionsDataSource;if(t){var e=X(t)?{data:t}:t;this.connectionsDataSource&&this._connectionsRefreshHandler?this.connectionsDataSource.unbind("change",this._connectionsRefreshHandler).unbind("requestStart",this._connectionsRequestStartHandler).unbind("error",this._connectionsErrorHandler):(this._connectionsRefreshHandler=h(this._refreshConnections,this),this._connectionsRequestStartHandler=h(this._connectionsRequestStart,this),this._connectionsErrorHandler=h(this._connectionsError,this)),this.connectionsDataSource=kendo.data.DataSource.create(e).bind("change",this._connectionsRefreshHandler).bind("requestStart",this._connectionsRequestStartHandler).bind("error",this._connectionsErrorHandler)}},_shapesRequestStart:function(t){"read"==t.type&&(this._loadingShapes=!0)},_connectionsRequestStart:function(t){"read"==t.type&&(this._loadingConnections=!0)},_error:function(){this._loadingShapes=!1},_connectionsError:function(){this._loadingConnections=!1},_refreshShapes:function(t){"remove"===t.action?this._shouldRefresh()&&this._removeShapes(t.items):"itemchange"===t.action?this._shouldRefresh()&&this._updateShapes(t.items,t.field):"add"===t.action?this._inactiveShapeItems.add(t.items):"sync"===t.action?this._syncShapes(t.items):this.refresh()},_shouldRefresh:function(){return!this._suspended},_suspendModelRefresh:function(){this._suspended=(this._suspended||0)+1},_resumeModelRefresh:function(){this._suspended=J.max((this._suspended||0)-1,0)},refresh:function(){this._loadingShapes=!1,this._loadingConnections||this._rebindShapesAndConnections()},_rebindShapesAndConnections:function(){this.clear(),this._addShapes(this.dataSource.view()),this.connectionsDataSource&&this._addConnections(this.connectionsDataSource.view(),!1),this.options.layout?this.layout(this.options.layout):this._redrawConnections(),this.trigger("dataBound")},refreshConnections:function(){this._loadingConnections=!1,this._loadingShapes||this._rebindShapesAndConnections()},_redrawConnections:function(){for(var t=this.connections,e=0;e<t.length;e++)t[e].refresh()},_removeShapes:function(t){var e,i,n=this._dataMap;for(i=0;i<t.length;i++)n[(e=t[i]).id]&&(this.remove(n[e.id],!1),n[e.id]=null)},_syncShapes:function(){var t=this,e=t._inactiveShapeItems;e.forEach((function(i){var n=i.dataItem,o=i.element;n.isNew()||(o?(o._setOptionsFromModel(),t.addShape(o,i.undoable),t._dataMap[n.id]=o):t._addDataItem(n),i.activate(),e.remove(n))}))},_updateShapes:function(t,e){for(var i=0;i<t.length;i++){var n=t[i],o=this._dataMap[n.id];o&&o.updateOptionsFromModel(n,e)}},_addShapes:function(t){for(var e=0;e<t.length;e++)this._addDataItem(t[e],!1)},_refreshConnections:function(t){"remove"===t.action?this._shouldRefresh()&&this._removeConnections(t.items):"add"===t.action?this._addConnections(t.items):"sync"===t.action||("itemchange"===t.action?this._shouldRefresh()&&this._updateConnections(t.items):this.refreshConnections())},_removeConnections:function(t){for(var e=0;e<t.length;e++)this.remove(this._connectionsDataMap[t[e].uid],!1),this._connectionsDataMap[t[e].uid]=null},_updateConnections:function(t){for(var e=0;e<t.length;e++){var i=t[e];this._connectionsDataMap[i.uid].updateOptionsFromModel(i)}},_addConnections:function(t,e){for(var i=t.length,n=0;n<i;n++){var o=t[n];this._addConnectionDataItem(o,e)}},_addConnectionDataItem:function(t,e){if(!this._connectionsDataMap[t.uid]){var i=this._validateConnector(t.from);N(i)&&null!==i||(i=new T(t.fromX,t.fromY));var n=this._validateConnector(t.to);if(N(n)&&null!==n||(n=new T(t.toX,t.toY)),N(i)&&N(n)){var o=c({},this.options.connectionDefaults);o.dataItem=t;var s=new wt(i,n,o);this._connectionsDataMap[t.uid]=s,this.addConnection(s,e)}}},_validateConnector:function(t){var e;return N(t)&&null!==t&&(e=this._dataMap[t]),e},_treeDataSource:function(){var t=this,e=t.options.dataSource;if((e=X(e)?{data:e}:e)instanceof kendo.data.DataSource&&!(e instanceof kendo.data.HierarchicalDataSource))throw new Error("Incorrect DataSource type. If a single dataSource instance is set to the diagram then it should be a HierarchicalDataSource. You should set only the options instead of an instance or a HierarchicalDataSource instance or supply connectionsDataSource as well.");e.fields||(e.fields=[{field:"text"},{field:"url"},{field:"spriteCssClass"},{field:"imageUrl"}]),t.dataSource&&t._refreshHandler&&t._unbindDataSource(),t._refreshHandler=h(t._refreshSource,t),t._errorHandler=h(t._error,t),t.dataSource=p.create(e).bind(Q,t._refreshHandler).bind($,t._errorHandler)},_unbindDataSource:function(){var t=this;t.dataSource.unbind(Q,t._refreshHandler).unbind($,t._errorHandler)},_adorn:function(t,i){i!==e&&t&&(i?(this._adorners.push(t),this.adornerLayer.append(t.visual)):(O.remove(this._adorners,t),this.adornerLayer.remove(t.visual)))},_showConnectors:function(t,e){e?this._connectorsAdorner.show(t):this._connectorsAdorner.destroy()},_updateAdorners:function(){for(var t=this._adorners,e=0;e<t.length;e++){var i=t[e];i.refreshBounds&&i.refreshBounds(),i.refresh()}},_refresh:function(){for(var t=0;t<this.connections.length;t++)this.connections[t].refresh()},_destroyToolBar:function(){this.singleToolBar&&(this.singleToolBar.hide(),this.singleToolBar.destroy(),this.singleToolBar=null)},_destroyGlobalToolBar:function(){this.toolBar&&(this.toolBar.hide(),this.toolBar.destroy(),this.toolBar=null)},exportDOMVisual:function(){var t=this.canvas._viewBox,e=o.transform().translate(-t.x,-t.y),i=new o.Rect([0,0],[t.width,t.height]),s=n.Path.fromRect(i),r=new n.Group({transform:e}),a=new n.Group({clip:s}),h=this.canvas.drawingElement.children[0];return a.append(r),r.children.push(h),a},exportVisual:function(){var t=o.transform().scale(1/this._zoom),e=new n.Group({transform:t}),i=this.mainLayer.drawingElement;return e.children.push(i),e},_syncChanges:function(){this._syncShapeChanges(),this._syncConnectionChanges()},_syncShapeChanges:function(){this.dataSource&&this._isEditable&&this.dataSource.sync()},_syncConnectionChanges:function(){var e=this;e.connectionsDataSource&&e._isEditable&&(t.when.apply(t,e._deferredConnectionUpdates).then((function(){e.connectionsDataSource.sync()})),e.deferredConnectionUpdates=[])}});function Ct(t){var e={};return N((t=t||{}).text)&&null!==t.text&&(e.text=t.text),N(t.x)&&null!==t.x&&(e.x=t.x),N(t.y)&&null!==t.y&&(e.y=t.y),N(t.width)&&null!==t.width&&(e.width=t.width),N(t.height)&&null!==t.height&&(e.height=t.height),N(t.type)&&null!==t.type&&(e.type=t.type),e}i.ExportMixin.extend(yt.fn,!0),kendo.PDFMixin&&kendo.PDFMixin.extend(yt.fn);var bt=kendo.Observable.extend({init:function(t,e){kendo.Observable.fn.init.call(this),this.diagram=t,this.options=c({},this.options,e),this._tools=[],this.createToolBar(),this.createTools(),this.appendTools(),this.options.modal&&this.createPopup(),this.bind(this.events,e)},events:["click"],createPopup:function(){this.container=t("<div/>").append(this.element),this._popup=this.container.kendoPopup({}).getKendoPopup()},appendTools:function(){for(var t=0;t<this._tools.length;t++){var e=this._tools[t];(e.buttons&&e.buttons.length||!N(e.buttons))&&this._toolBar.add(e)}},createToolBar:function(){this.element=t("<div/>"),this._toolBar=this.element.kendoToolBar({click:h(this.click,this),resizable:!1}).getKendoToolBar(),this.element.css("border","none")},createTools:function(){for(var t=0;t<this.options.tools.length;t++)this.createTool(this.options.tools[t])},createTool:function(t){q(t)||(t={name:t});var e=t.name+"Tool";this[e]?this[e](t):this._tools.push(c({},t,{attributes:this._setAttributes({action:t.name})}))},showAt:function(t){var e=parseInt(this.options.popupZIndex,10);this._popup&&(this._popup.open(t.x,t.y),e&&this._popup.wrapper.css("zIndex",e))},hide:function(){this._popup&&this._popup.close()},newGroup:function(){return{type:"buttonGroup",buttons:[]}},editTool:function(){this._tools.push({icon:"edit",showText:"overflow",type:"button",text:"Edit",attributes:this._setAttributes({action:"edit"})})},deleteTool:function(){this._tools.push({icon:"close",showText:"overflow",type:"button",text:"Delete",attributes:this._setAttributes({action:"delete"})})},rotateAnticlockwiseTool:function(t){this._appendGroup("rotate"),this._rotateGroup.buttons.push({icon:"rotate-left",showText:"overflow",text:"RotateAnticlockwise",group:"rotate",attributes:this._setAttributes({action:"rotateAnticlockwise",step:t.step})})},rotateClockwiseTool:function(t){this._appendGroup("rotate"),this._rotateGroup.buttons.push({icon:"rotate-right",attributes:this._setAttributes({action:"rotateClockwise",step:t.step}),showText:"overflow",text:"RotateClockwise",group:"rotate"})},createShapeTool:function(){this._appendGroup("create"),this._createGroup.buttons.push({icon:"shape",showText:"overflow",text:"CreateShape",group:"create",attributes:this._setAttributes({action:"createShape"})})},createConnectionTool:function(){this._appendGroup("create"),this._createGroup.buttons.push({icon:"connector",showText:"overflow",text:"CreateConnection",group:"create",attributes:this._setAttributes({action:"createConnection"})})},undoTool:function(){this._appendGroup("history"),this._historyGroup.buttons.push({icon:"undo",showText:"overflow",text:"Undo",group:"history",attributes:this._setAttributes({action:"undo"})})},redoTool:function(){this._appendGroup("history"),this._historyGroup.buttons.push({icon:"redo",showText:"overflow",text:"Redo",group:"history",attributes:this._setAttributes({action:"redo"})})},_appendGroup:function(t){var e="_"+t+"Group";this[e]||(this[e]=this.newGroup(),this._tools.push(this[e]))},_setAttributes:function(t){var e={};return t.action&&(e[kendo.attr("action")]=t.action),t.step&&(e[kendo.attr("step")]=t.step),e},_getAttributes:function(t){var e={},i=t.attr(kendo.attr("action"));i&&(e.action=i);var n=t.attr(kendo.attr("step"));return n&&(e.step=n),e},click:function(e){var i=this._getAttributes(t(e.target)),n=i.action;n&&this[n]&&this[n](i),this.trigger("click",this.eventData(n,e.target))},eventData:function(t,e){for(var i,n=this.selectedElements(),o=n.length,s=[],r=[],a=0;a<o;a++)(i=n[a])instanceof vt?s.push(i):r.push(i);return{shapes:s,connections:r,action:t,target:e}},delete:function(){var t=this.diagram._triggerRemove(this.selectedElements());t.length&&(this.diagram.remove(t,!0),this.diagram._syncChanges())},edit:function(){var t=this.selectedElements();1===t.length&&this.diagram.edit(t[0])},rotateClockwise:function(t){var e=parseFloat(t.step||90);this._rotate(e)},rotateAnticlockwise:function(t){var e=parseFloat(t.step||90);this._rotate(-e)},_rotate:function(t){var e=this.diagram._resizingAdorner;e.angle(e.angle()+t),e.rotate()},selectedElements:function(){return this.diagram.select()},createShape:function(){this.diagram.createShape()},createConnection:function(){this.diagram.createConnection()},undo:function(){this.diagram.undo()},redo:function(){this.diagram.redo()},destroy:function(){this.diagram=null,this.element=null,this.options=null,this._toolBar&&this._toolBar.destroy(),this._popup&&this._popup.destroy()}}),St=kendo.Observable.extend({init:function(t,e){kendo.Observable.fn.init.call(this),this.options=u(!0,{},this.options,e),this.element=t,this.model=this.options.model,this.fields=this._getFields(),this._initContainer(),this.createEditable()},options:{editors:{}},_initContainer:function(){this.wrapper=this.element},createEditable:function(){var t=this.options;this.editable=new kendo.ui.Editable(this.wrapper,{fields:this.fields,target:t.target,clearContainer:!1,model:this.model})},_isEditable:function(t){return this.model.editable&&this.model.editable(t)},_getFields:function(){var t=[],e=this.model.fields;for(var i in e){var n={};if(this._isEditable(i)){var o=this.options.editors[i];o&&(n.editor=o),n.field=i,t.push(n)}}return t},end:function(){return this.editable.end()},destroy:function(){this.editable.destroy(),this.editable.element.find("["+kendo.attr("container-for")+"]").empty(),this.model=this.wrapper=this.element=this.columns=this.editable=null}}),xt=St.extend({init:function(t,e){St.fn.init.call(this,t,e),this.bind(this.events,this.options),this.open()},events:["update","cancel"],options:{window:{modal:!0,resizable:!1,draggable:!0,title:"Edit",visible:!1}},_initContainer:function(){var e=this;this.wrapper=t('<div class="k-popup-edit-form"/>').attr(kendo.attr("uid"),this.model.uid);var i="";this.options.template?(i+=this._renderTemplate(),this.fields=[]):i+=this._renderFields(),i+=this._renderButtons(),this.wrapper.append(t('<div class="k-edit-form-container"/>').append(i)),this.window=new kendo.ui.Window(this.wrapper.appendTo(this.element),this.options.window),this.window.bind("close",(function(t){t.userTriggered&&(t.sender.element.focus(),e._cancelClick(t))})),this._attachButtonEvents()},_renderTemplate:function(){var t=this.options.template;return"string"==typeof t&&(t=kendo.unescape(t)),kendo.template(t)(this.model)},_renderFields:function(){for(var t="",e=0;e<this.fields.length;e++){var i=this.fields[e];t+='<div class="k-edit-label"><label for="'+i.field+'">'+(i.field||"")+"</label></div>",this._isEditable(i.field)&&(t+="<div "+kendo.attr("container-for")+'="'+i.field+'" class="k-edit-field"></div>')}return t},_renderButtons:function(){var t='<div class="k-edit-buttons k-state-default">';return t+=this._createButton("update"),(t+=this._createButton("cancel"))+"</div>"},_createButton:function(t){return kendo.template('<a class="k-button k-button-icontext #=className#" href="\\#"><span class="#=iconClass# #=imageClass#"></span>#=text#</a>')(ut[t])},_attachButtonEvents:function(){this._cancelClickHandler=h(this._cancelClick,this),this.window.element.on(j+W,"a.k-diagram-cancel",this._cancelClickHandler),this._updateClickHandler=h(this._updateClick,this),this.window.element.on(j+W,"a.k-diagram-update",this._updateClickHandler)},_updateClick:function(t){t.preventDefault(),this.trigger("update")},_cancelClick:function(t){t.preventDefault(),this.trigger("cancel")},open:function(){this.window.center().open()},close:function(){this.window.bind("deactivate",h(this.destroy,this)).close()},destroy:function(){this.window.close().destroy(),this.window.element.off(j+W,"a.k-diagram-cancel",this._cancelClickHandler),this.window.element.off(j+W,"a.k-diagram-update",this._updateClickHandler),this._cancelClickHandler=null,this._editUpdateClickHandler=null,this.window=null,St.fn.destroy.call(this)}});function Tt(e,i){var n=this.dataSource.reader.model;if(n){var o=n.fn.fields.text?"text":n.idField;t("<input name='"+i.field+"' />").appendTo(e).kendoDropDownList({dataValueField:n.idField,dataTextField:o,dataSource:this.dataSource.data().toJSON(),optionLabel:" ",valuePrimitive:!0})}}function kt(t){this.dataItem=t,this.callbacks=[]}function Dt(){this.items={}}kt.fn=kt.prototype={onActivate:function(e){var i=t.Deferred();return this.callbacks.push({callback:e,deferred:i}),i},activate:function(){for(var t,e=this.callbacks,i=0;i<e.length;i++)(t=this.callbacks[i]).callback(this.dataItem),t.deferred.resolve();this.callbacks=[]}},Dt.fn=Dt.prototype={add:function(t){for(var e=0;e<t.length;e++)this.items[t[e].uid]=new kt(t[e])},forEach:function(t){for(var e in this.items)t(this.items[e])},getByUid:function(t){return this.items[t]},remove:function(t){delete this.items[t.uid]}};var It=a.extend({init:function(){this.shapes=[]},_add:function(t,e){this.shapes.push({bounds:e,shape:t}),t._quadNode=this},insert:function(t,e){this._add(t,e)},remove:function(t){for(var e=this.shapes,i=e.length,n=0;n<i;n++)if(e[n].shape===t){e.splice(n,1);break}},hitTestRect:function(t,e){for(var n=this.shapes,o=n.length,s=0;s<o;s++)if(this._testRect(n[s].shape,t)&&!i.inArray(n[s].shape,e))return!0},_testRect:function(t,e){var i=t.rotate().angle,n=t.bounds();return i?k.rects(e,n,-i):n.overlaps(e)}}),Mt=It.extend({init:function(t){It.fn.init.call(this),this.children=[],this.rect=t},inBounds:function(t){var e=this.rect,i=e.bottomRight(),n=t.bottomRight();return e.x<=t.x&&e.y<=t.y&&n.x<=i.x&&n.y<=i.y},overlapsBounds:function(t){return this.rect.overlaps(t)},insert:function(t,e){var i=!1,n=this.children,o=n.length;if(this.inBounds(e)){if(!o&&this.shapes.length<4)this._add(t,e);else{o||this._initChildren();for(var s=0;s<n.length;s++)if(n[s].insert(t,e)){i=!0;break}i||this._add(t,e)}i=!0}return i},_initChildren:function(){var t,e,i=this.rect,n=this.children,o=this.shapes,s=i.center(),r=i.width/2,a=i.height/2;for(n.push(new Mt(new w(i.x,i.y,r,a)),new Mt(new w(s.x,i.y,r,a)),new Mt(new w(i.x,s.y,r,a)),new Mt(new w(s.x,s.y,r,a))),e=o.length-1;e>=0;e--)for(t=0;t<n.length;t++)if(n[t].insert(o[e].shape,o[e].bounds)){o.splice(e,1);break}},hitTestRect:function(t,e){var i,n=this.children,o=n.length,s=!1;if(this.overlapsBounds(t))if(It.fn.hitTestRect.call(this,t,e))s=!0;else for(i=0;i<o;i++)if(n[i].hitTestRect(t,e)){s=!0;break}return s}}),Bt=a.extend({ROOT_SIZE:1e3,init:function(t){var e=h(this._boundsChange,this);t.bind(Z,e),t.bind(nt,e),this.initRoots()},initRoots:function(){this.rootMap={},this.root=new It},clear:function(){this.initRoots()},_boundsChange:function(t){t.item._quadNode&&t.item._quadNode.remove(t.item),this.insert(t.item)},insert:function(t){var e=t.bounds(lt),i=this.ROOT_SIZE,n=this.getSectors(e),o=n[0][0],s=n[1][0];this.inRoot(n)?this.root.insert(t,e):(this.rootMap[o]||(this.rootMap[o]={}),this.rootMap[o][s]||(this.rootMap[o][s]=new Mt(new w(o*i,s*i,i,i))),this.rootMap[o][s].insert(t,e))},remove:function(t){t._quadNode&&t._quadNode.remove(t)},inRoot:function(t){return t[0].length>1||t[1].length>1},getSectors:function(t){for(var e=this.ROOT_SIZE,i=t.bottomRight(),n=J.floor(i.x/e),o=J.floor(i.y/e),s=[[],[]],r=J.floor(t.x/e);r<=n;r++)s[0].push(r);for(var a=J.floor(t.y/e);a<=o;a++)s[1].push(a);return s},hitTestRect:function(t,e){var i,n,o,s,r,a=this.getSectors(t);if(this.root.hitTestRect(t,e))return!0;for(i=0;i<a[0].length;i++)for(o=a[0][i],n=0;n<a[1].length;n++)if(s=a[1][n],(r=(this.rootMap[o]||{})[s])&&r.hitTestRect(t,e))return!0;return!1}});function Et(t){var e=t;return t instanceof kendo.data.Model&&((e=t.toJSON())[t.idField]=t._defaultId),e}function Rt(t){var e,i,n=[],o=[];for(i=0;i<t.length;i++)(e=t[i])instanceof vt?o.push(e):n.push(e);return{shapes:o,connections:n}}function Pt(t,e){return t.reader.model?new t.reader.model(e):new kendo.data.ObservableObject(e)}function Ot(t,e){N(e[t])&&e.set(t,null)}function zt(t,e,i){for(var n,o=0;o<i.length;o++)n=i[o],e&&!N(e[n])&&(e[n]=t[n])}function At(t){t.preventDefault()}i.ui.plugin(yt),c(s,{Shape:vt,Connection:wt,Connector:gt,DiagramToolBar:bt,QuadNode:Mt,QuadRoot:It,ShapesQuadTree:Bt,PopupEditor:xt})}(window.kendo.jQuery)})?n.apply(e,o):n)||(t.exports=s)},893:function(t,e){t.exports=i(3696)},894:function(t,e){t.exports=i(2565)},895:function(t,e){t.exports=i(3566)},896:function(t,e){t.exports=i(3541)},897:function(t,e){t.exports=i(7383)},898:function(t,e){t.exports=i(219)},899:function(t,e){t.exports=i(8635)},900:function(t,e){t.exports=i(8469)}})}}]);