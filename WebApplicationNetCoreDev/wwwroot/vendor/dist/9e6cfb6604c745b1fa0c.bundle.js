(self.webpackChunk_5_112_1332=self.webpackChunk_5_112_1332||[]).push([[8469],{8469:(t,e,i)=>{t.exports=function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}return i.m=t,i.c=e,i.p="",i(0)}({0:function(t,e,i){t.exports=i(901)},3:function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},901:function(t,e,i){var n,r,s;i(3),r=[i(902)],void 0===(s="function"==typeof(n=function(){var t,e,i,n,r,s,o,a,h,l,d,g,u,c,p,f,y,v,m,w,x,C,S,D,M;t=window.kendo.jQuery,e=window.kendo,i=e.dataviz.diagram,n=i.Graph,r=i.Node,s=i.Link,o=e.deepExtend,a=i.Size,h=i.Rect,l=i.Dictionary,d=i.Set,g=i.Graph,u=i.Utils,c=i.Point,p=1e-6,f=Math.PI/180,y=u.contains,v=t.grep,m=e.Class.extend({defaultOptions:{type:"Tree",subtype:"Down",roots:null,animate:!1,limitToView:!1,friction:.9,nodeDistance:50,iterations:300,horizontalSeparation:90,verticalSeparation:50,underneathVerticalTopOffset:15,underneathHorizontalOffset:15,underneathVerticalSeparation:15,grid:{width:1500,offsetX:50,offsetY:50,componentSpacingX:20,componentSpacingY:20},layerSeparation:50,layeredIterations:2,startRadialAngle:0,endRadialAngle:360,radialSeparation:150,radialFirstLevelSeparation:200,keepComponentsInOneRadialLayout:!1,ignoreContainers:!0,layoutContainerChildren:!1,ignoreInvisible:!0,animateTransitions:!1},init:function(){},gridLayoutComponents:function(t){if(!t)throw"No components supplied.";u.forEach(t,(function(t){t.calcBounds()})),t.sort((function(t,e){return e.bounds.width-t.bounds.width}));for(var e,i=this.options.grid.width,n=this.options.grid.componentSpacingX,r=this.options.grid.componentSpacingY,s=0,o=this.options.grid.offsetX,a=o,h=this.options.grid.offsetY,l=[],d=[];t.length>0;){a>=i&&(a=o,h+=s+r,s=0);var g=t.pop();for(this.moveToOffset(g,new c(a,h)),e=0;e<g.nodes.length;e++)d.push(g.nodes[e]);for(e=0;e<g.links.length;e++)l.push(g.links[e]);var p=g.bounds,f=p.height;(f<=0||isNaN(f))&&(f=0);var y=p.width;(y<=0||isNaN(y))&&(y=0),f>=s&&(s=f),a+=y+n}return{nodes:d,links:l}},moveToOffset:function(t,e){var i,n,r=t.bounds,s=e.x-r.x,o=e.y-r.y;for(i=0;i<t.nodes.length;i++){var a=t.nodes[i],l=a.bounds();0===l.width&&0===l.height&&0===l.x&&0===l.y&&(l=new h(0,0,0,0)),l.x+=s,l.y+=o,a.bounds(l)}for(i=0;i<t.links.length;i++){var d=t.links[i];if(d.points){var g=[],u=d.points;for(n=0;n<u.length;n++){var p=u[n];p.x+=s,p.y+=o,g.push(p)}d.points=g}}return this.currentHorizontalOffset+=r.width+this.options.grid.offsetX,new c(s,o)},transferOptions:function(t){this.options=e.deepExtend({},this.defaultOptions),u.isUndefined(t)||(this.options=e.deepExtend(this.options,t||{}))}}),w=e.Class.extend({init:function(t){this.nodeMap=new l,this.shapeMap=new l,this.nodes=[],this.edges=[],this.edgeMap=new l,this.finalNodes=[],this.finalLinks=[],this.ignoredConnections=[],this.ignoredShapes=[],this.hyperMap=new l,this.hyperTree=new n,this.finalGraph=null,this.diagram=t},convert:function(t){if(u.isUndefined(this.diagram))throw"No diagram to convert.";return this.options=e.deepExtend({ignoreInvisible:!0,ignoreContainers:!0,layoutContainerChildren:!1},t||{}),this.clear(),this._renormalizeShapes(),this._renormalizeConnections(),this.finalNodes=new l(this.nodes),this.finalLinks=new l(this.edges),this.finalGraph=new n,this.finalNodes.forEach((function(t){this.finalGraph.addNode(t)}),this),this.finalLinks.forEach((function(t){this.finalGraph.addExistingLink(t)}),this),this.finalGraph},mapConnection:function(t){return this.edgeMap.get(t.id)},mapShape:function(t){return this.nodeMap.get(t.id)},getEdge:function(t,e){return u.first(t.links,(function(i){return i.getComplement(t)===e}))},clear:function(){this.finalGraph=null,this.hyperTree=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new g:null,this.hyperMap=!this.options.ignoreContainers&&this.options.layoutContainerChildren?new l:null,this.nodeMap=new l,this.shapeMap=new l,this.nodes=[],this.edges=[],this.edgeMap=new l,this.ignoredConnections=[],this.ignoredShapes=[],this.finalNodes=[],this.finalLinks=[]},listToRoot:function(t){var e=[],i=t.container;if(!i)return e;for(e.push(i);i.parentContainer;)i=i.parentContainer,e.push(i);return e.reverse(),e},firstNonIgnorableContainer:function(t){return t.isContainer&&!this._isIgnorableItem(t)?t:t.parentContainer?this.firstNonIgnorableContainer(t.parentContainer):null},isContainerConnection:function(t,e){return!(!t.isContainer||!this.isDescendantOf(t,e))||e.isContainer&&this.isDescendantOf(e,t)},isDescendantOf:function(t,e){if(!t.isContainer)throw"Expecting a container.";if(t===e)return!1;if(y(t.children,e))return!0;for(var i=[],n=0,r=t.children.length;n<r;n++){var s=t.children[n];s.isContainer&&this.isDescendantOf(s,e)&&i.push(s)}return i.length>0},isIgnorableItem:function(t){return this.options.ignoreInvisible?!(t.isCollapsed&&this._isVisible(t)||!t.isCollapsed&&this._isVisible(t)):t.isCollapsed&&!this._isTop(t)},isShapeMapped:function(t){return t.isCollapsed&&!this._isVisible(t)&&!this._isTop(t)},leastCommonAncestor:function(t,e){if(!t)throw"Parameter should not be null.";if(!e)throw"Parameter should not be null.";if(!this.hyperTree)throw"No hypertree available.";var i=this.listToRoot(t),n=this.listToRoot(e),r=null;if(u.isEmpty(i)||u.isEmpty(n))return this.hyperTree.root.data;for(var s=i[0],o=n[0],a=0;s===o&&(r=i[a],!(++a>=i.length||a>=n.length));)s=i[a],o=n[a];return r?v(this.hyperTree.nodes,(function(t){return t.data.container===r})):this.hyperTree.root.data},_isTop:function(t){return!t.parentContainer},_isVisible:function(t){return!!t.visible()&&(t.parentContainer?this._isVisible(t.parentContainer):t.visible())},_isCollapsed:function(t){return!(!t.isContainer||!t.isCollapsed)||t.parentContainer&&this._isCollapsed(t.parentContainer)},_renormalizeShapes:function(){if(!this.options.ignoreContainers)throw"Containers are not supported yet, but stay tuned.";for(var t=0,e=this.diagram.shapes.length;t<e;t++){var i=this.diagram.shapes[t];if(this.options.ignoreInvisible&&!this._isVisible(i)||i.isContainer)this.ignoredShapes.push(i);else{var n=new r(i.id,i);n.isVirtual=!1,this.nodeMap.add(i.id,n),this.nodes.push(n)}}},_renormalizeConnections:function(){if(0!==this.diagram.connections.length)for(var t=0,e=this.diagram.connections.length;t<e;t++){var i=this.diagram.connections[t];if(this.isIgnorableItem(i))this.ignoredConnections.push(i);else{var n=i.sourceConnector?i.sourceConnector.shape:null,r=i.targetConnector?i.targetConnector.shape:null;if(n&&r)if(!y(this.ignoredShapes,n)||this.shapeMap.containsKey(n))if(!y(this.ignoredShapes,r)||this.shapeMap.containsKey(r)){this.shapeMap.containsKey(n)&&(n=this.shapeMap[n]),this.shapeMap.containsKey(r)&&(r=this.shapeMap[r]);var o=this.mapShape(n),a=this.mapShape(r);if(o===a||this.areConnectedAlready(o,a))this.ignoredConnections.push(i);else{if(null===o||null===a)throw"A shape was not mapped to a node.";if(!this.options.ignoreContainers)throw"Containers are not supported yet, but stay tuned.";if(o.isVirtual||a.isVirtual)this.ignoredConnections.push(i);else{var h=new s(o,a,i.id,i);this.edgeMap.add(i.id,h),this.edges.push(h)}}}else this.ignoredConnections.push(i);else this.ignoredConnections.push(i);else this.ignoredConnections.push(i)}}},areConnectedAlready:function(t,e){return u.any(this.edges,(function(i){return i.source===t&&i.target===e||i.source===e&&i.target===t}))}}),x=m.extend({init:function(t){if(m.fn.init.call(this),u.isUndefined(t))throw"Diagram is not specified.";this.diagram=t},layout:function(t){this.transferOptions(t);var e=new w(this.diagram).convert(t);if(!e.isEmpty()){var n=e.getConnectedComponents();if(!u.isEmpty(n)){for(var r=0;r<n.length;r++){var s=n[r];this.layoutGraph(s,t)}var o=this.gridLayoutComponents(n);return new i.LayoutState(this.diagram,o)}}},layoutGraph:function(t,e){u.isDefined(e)&&this.transferOptions(e),this.graph=t;var i=9*this.options.nodeDistance;this.temperature=i;var n=this._expectedBounds();this.width=n.width,this.height=n.height;for(var r=0;r<this.options.iterations;r++)this.refineStage=r>=5*this.options.iterations/6,this.tick(),this.temperature=this.refineStage?i/30:i*(1-r/(2*this.options.iterations))},tick:function(){var t;for(t=0;t<this.graph.nodes.length;t++)this._repulsion(this.graph.nodes[t]);for(t=0;t<this.graph.links.length;t++)this._attraction(this.graph.links[t]);for(t=0;t<this.graph.nodes.length;t++){var e=this.graph.nodes[t],i=Math.sqrt(e.dx*e.dx+e.dy*e.dy);if(0===i)return;e.x+=Math.min(i,this.temperature)*e.dx/i,e.y+=Math.min(i,this.temperature)*e.dy/i,this.options.limitToView&&(e.x=Math.min(this.width,Math.max(e.width/2,e.x)),e.y=Math.min(this.height,Math.max(e.height/2,e.y)))}},_shake:function(t){var e=Math.random()*this.options.nodeDistance/4,i=2*Math.random()*Math.PI;t.x+=e*Math.cos(i),t.y-=e*Math.sin(i)},_InverseSquareForce:function(t,e,i){var n;if(this.refineStage){var r=e.x-i.x,s=e.y-i.y,o=e.width/2,a=e.height/2,h=i.width/2,l=i.height/2;n=Math.pow(r,2)/Math.pow(o+h+this.options.nodeDistance,2)+Math.pow(s,2)/Math.pow(a+l+this.options.nodeDistance,2)}else n=Math.pow(t,2)/Math.pow(this.options.nodeDistance,2);return 4*n/3},_SquareForce:function(t,e,i){return 1/this._InverseSquareForce(t,e,i)},_repulsion:function(t){t.dx=0,t.dy=0,u.forEach(this.graph.nodes,(function(e){if(e!==t){for(;t.x===e.x&&t.y===e.y;)this._shake(e);var i=t.x-e.x,n=t.y-e.y,r=Math.sqrt(i*i+n*n),s=2*this._SquareForce(r,t,e);t.dx+=i/r*s,t.dy+=n/r*s}}),this)},_attraction:function(t){var e=t.target,i=t.source;if(i!==e){for(;i.x===e.x&&i.y===e.y;)this._shake(e);var n=i.x-e.x,r=i.y-e.y,s=Math.sqrt(n*n+r*r),o=5*this._InverseSquareForce(s,i,e),a=n/s*o,h=r/s*o;e.dx+=a,e.dy+=h,i.dx-=a,i.dy-=h}},_expectedBounds:function(){var t,e=this.graph.nodes.length;if(0===e)return t;var i=(t=u.fold(this.graph.nodes,(function(t,e){var i=e.width*e.height;return i>0?t+=Math.sqrt(i):0}),0,this))/e*Math.ceil(Math.sqrt(e));return{width:i*Math.sqrt(1.5)*4,height:i/Math.sqrt(1.5)*4}}}),C=e.Class.extend({init:function(t){this.center=null,this.options=t},layout:function(t,e){if(this.graph=t,this.graph.nodes&&0!==this.graph.nodes.length){if(!y(this.graph.nodes,e))throw"The given root is not in the graph.";this.center=e,this.graph.cacheRelationships(),this.layoutSwitch()}},layoutLeft:function(t){this.setChildrenDirection(this.center,"Left",!1),this.setChildrenLayout(this.center,"Default",!1);var e,i,n,r=0,s=0;for(i=0;i<t.length;i++){(n=t[i]).TreeDirection="Left";var o=this.measure(n,a.Empty);s=Math.max(s,o.Width),r+=o.height+this.options.verticalSeparation}r-=this.options.verticalSeparation;var h=this.center.x-this.options.horizontalSeparation;for(e=this.center.y+(this.center.height-r)/2,i=0;i<t.length;i++){n=t[i];var l=new c(h-n.Size.width,e);this.arrange(n,l),e+=n.Size.height+this.options.verticalSeparation}},layoutRight:function(t){this.setChildrenDirection(this.center,"Right",!1),this.setChildrenLayout(this.center,"Default",!1);var e,i,n,r=0,s=0;for(i=0;i<t.length;i++){(n=t[i]).TreeDirection="Right";var o=this.measure(n,a.Empty);s=Math.max(s,o.Width),r+=o.height+this.options.verticalSeparation}r-=this.options.verticalSeparation;var h=this.center.x+this.options.horizontalSeparation+this.center.width;for(e=this.center.y+(this.center.height-r)/2,i=0;i<t.length;i++){n=t[i];var l=new c(h,e);this.arrange(n,l),e+=n.Size.height+this.options.verticalSeparation}},layoutUp:function(t){this.setChildrenDirection(this.center,"Up",!1),this.setChildrenLayout(this.center,"Default",!1);var e,i,n,r=0;for(n=0;n<t.length;n++)(i=t[n]).TreeDirection="Up",r+=this.measure(i,a.Empty).width+this.options.horizontalSeparation;r-=this.options.horizontalSeparation;var s=this.center.x+this.center.width/2-r/2;for(n=0;n<t.length;n++){i=t[n],e=this.center.y-this.options.verticalSeparation-i.Size.height;var o=new c(s,e);this.arrange(i,o),s+=i.Size.width+this.options.horizontalSeparation}},layoutDown:function(t){var e,i;this.setChildrenDirection(this.center,"Down",!1),this.setChildrenLayout(this.center,"Default",!1);var n,r=0;for(i=0;i<t.length;i++)(e=t[i]).treeDirection="Down",r+=this.measure(e,a.Empty).width+this.options.horizontalSeparation;r-=this.options.horizontalSeparation;var s=this.center.x+this.center.width/2-r/2;for(n=this.center.y+this.options.verticalSeparation+this.center.height,i=0;i<t.length;i++){e=t[i];var o=new c(s,n);this.arrange(e,o),s+=e.Size.width+this.options.horizontalSeparation}},layoutRadialTree:function(){this.setChildrenDirection(this.center,"Radial",!1),this.setChildrenLayout(this.center,"Default",!1),this.previousRoot=null;var t=this.options.startRadialAngle*f,e=this.options.endRadialAngle*f;if(e<=t)throw"Final angle should not be less than the start angle.";this.maxDepth=0,this.origin=new c(this.center.x,this.center.y),this.calculateAngularWidth(this.center,0),this.maxDepth>0&&this.radialLayout(this.center,this.options.radialFirstLevelSeparation,t,e),this.center.Angle=e-t},tipOverTree:function(t,e){u.isUndefined(e)&&(e=0),this.setChildrenDirection(this.center,"Down",!1),this.setChildrenLayout(this.center,"Default",!1),this.setChildrenLayout(this.center,"Underneath",!1,e);var i,n,r,s=0;for(r=0;r<t.length;r++)(n=t[r]).TreeDirection="Down",s+=this.measure(n,a.Empty).width+this.options.horizontalSeparation;s-=this.options.horizontalSeparation,s-=t[t.length-1].width,s+=t[t.length-1].associatedShape.bounds().width;var o=this.center.x+this.center.width/2-s/2;for(i=this.center.y+this.options.verticalSeparation+this.center.height,r=0;r<t.length;r++){n=t[r];var h=new c(o,i);this.arrange(n,h),o+=n.Size.width+this.options.horizontalSeparation}},calculateAngularWidth:function(t,e){e>this.maxDepth&&(this.maxDepth=e);var i=0,n=0===e?0:Math.sqrt(2e6)/e;if(t.children.length>0){for(var r=0,s=t.children.length;r<s;r++){var o=t.children[r];i+=this.calculateAngularWidth(o,e+1)}i=Math.max(n,i)}else i=n;return t.sectorAngle=i,i},sortChildren:function(t){var e,i=0;if(t.parents.length>1)throw"Node is not part of a tree.";var n=t.parents[0];if(n){var r=new c(n.x,n.y),s=new c(t.x,t.y);i=this.normalizeAngle(Math.atan2(r.y-s.y,r.x-s.x))}var o=t.children.length;if(0===o)return null;var a=[],h=[];for(e=0;e<o;++e){var l=t.children[e],d=new c(l.x,l.y);h[e]=e,a[e]=this.normalizeAngle(-i+Math.atan2(d.y-d.y,d.x-d.x))}u.bisort(a,h);var g=[],p=t.children;for(e=0;e<o;++e)g.push(p[h[e]]);return g},normalizeAngle:function(t){for(;t>2*Math.PI;)t-=2*Math.PI;for(;t<0;)t+=2*Math.PI;return t},radialLayout:function(t,e,i,n){for(var r=n-i,s=r/2,o=t.sectorAngle,a=0,h=this.sortChildren(t),l=0,d=h.length;l<d;l++){var g=h[l],u=g,c=u.sectorAngle/o;g.children.length>0&&this.radialLayout(g,e+this.options.radialSeparation,i+a*r,i+(a+c)*r),this.setPolarLocation(g,e,i+a*r+c*s),u.angle=c*r,a+=c}},setPolarLocation:function(t,e,i){t.x=this.origin.x+e*Math.cos(i),t.y=this.origin.y+e*Math.sin(i),t.BoundingRectangle=new h(t.x,t.y,t.width,t.height)},setChildrenDirection:function(t,e,i){var n=t.treeDirection;this.graph.depthFirstTraversal(t,(function(t){t.treeDirection=e})),i||(t.treeDirection=n)},setChildrenLayout:function(t,e,i,n){u.isUndefined(n)&&(n=0);var r=t.childrenLayout;n>0?(this.graph.assignLevels(t),this.graph.depthFirstTraversal(t,(function(t){t.level>=n+1&&(t.childrenLayout=e)}))):(this.graph.depthFirstTraversal(t,(function(t){t.childrenLayout=e})),i||(t.childrenLayout=r))},measure:function(t,e){var i,n=0,r=0,s=new a(0,0);if(!t)throw"";var o=t.associatedShape.bounds(),h=o.width,l=o.height;if(1!==t.parents.length)throw"Node not in a spanning tree.";var d=t.parents[0];if("Undefined"===t.treeDirection&&(t.treeDirection=d.treeDirection),u.isEmpty(t.children))s=new a(Math.abs(h)<p?50:h,Math.abs(l)<p?25:l);else if(1===t.children.length){switch(t.treeDirection){case"Radial":i=this.measure(t.children[0],e),n=h+this.options.radialSeparation*Math.cos(t.AngleToParent)+i.width,r=l+Math.abs(this.options.radialSeparation*Math.sin(t.AngleToParent))+i.height;break;case"Left":case"Right":switch(t.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":n=h+(i=this.measure(t.children[0],e)).width+this.options.underneathHorizontalOffset,r=l+this.options.underneathVerticalTopOffset+i.height;break;case"Default":i=this.measure(t.children[0],e),n=h+this.options.horizontalSeparation+i.width,r=Math.max(l,i.height);break;default:throw"Unhandled TreeDirection in the Radial layout measuring."}break;case"Up":case"Down":switch(t.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":i=this.measure(t.children[0],e),n=Math.max(h,i.width+this.options.underneathHorizontalOffset),r=l+this.options.underneathVerticalTopOffset+i.height;break;case"Default":i=this.measure(t.children[0],e),r=l+this.options.verticalSeparation+i.height,n=Math.max(h,i.width);break;default:throw"Unhandled TreeDirection in the Down layout measuring."}break;default:throw"Unhandled TreeDirection in the layout measuring."}s=new a(n,r)}else{var g,c;switch(t.treeDirection){case"Left":case"Right":switch(t.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(n=h,r=l+this.options.underneathVerticalTopOffset,g=0;g<t.children.length;g++)c=t.children[g],i=this.measure(c,e),n=Math.max(n,i.width+this.options.underneathHorizontalOffset),r+=i.height+this.options.underneathVerticalSeparation;r-=this.options.underneathVerticalSeparation;break;case"Default":for(n=h,r=0,g=0;g<t.children.length;g++)c=t.children[g],i=this.measure(c,e),n=Math.max(n,h+this.options.horizontalSeparation+i.width),r+=i.height+this.options.verticalSeparation;r-=this.options.verticalSeparation;break;default:throw"Unhandled TreeDirection in the Right layout measuring."}break;case"Up":case"Down":switch(t.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(n=h,r=l+this.options.underneathVerticalTopOffset,g=0;g<t.children.length;g++)c=t.children[g],i=this.measure(c,e),n=Math.max(n,i.width+this.options.underneathHorizontalOffset),r+=i.height+this.options.underneathVerticalSeparation;r-=this.options.underneathVerticalSeparation;break;case"Default":for(n=0,r=0,g=0;g<t.children.length;g++)c=t.children[g],n+=(i=this.measure(c,e)).width+this.options.horizontalSeparation,r=Math.max(r,i.height+this.options.verticalSeparation+l);n-=this.options.horizontalSeparation;break;default:throw"Unhandled TreeDirection in the Down layout measuring."}break;default:throw"Unhandled TreeDirection in the layout measuring."}s=new a(n,r)}return t.SectorAngle=Math.sqrt(n*n/4+r*r/4),t.Size=s,s},arrange:function(t,e){var i,n,r,s,o,a,l,d=t.associatedShape.bounds(),g=d.width,f=d.height;if(u.isEmpty(t.children))t.x=e.x,t.y=e.y,t.BoundingRectangle=new h(e.x,e.y,g,f);else switch(t.treeDirection){case"Left":switch(t.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(l=e,t.x=l.x,t.y=l.y,t.BoundingRectangle=new h(t.x,t.y,t.width,t.height),a=e.y+f+this.options.underneathVerticalTopOffset,i=0;i<r.children.length;i++)r=r.children[i],o=l.x-r.associatedShape.width-this.options.underneathHorizontalOffset,n=new c(o,a),this.arrange(r,n),a+=r.Size.height+this.options.underneathVerticalSeparation;break;case"Default":for(l=new c(e.x+t.Size.width-g,e.y+(t.Size.height-f)/2),t.x=l.x,t.y=l.y,t.BoundingRectangle=new h(t.x,t.y,t.width,t.height),o=l.x-this.options.horizontalSeparation,a=e.y,i=0;i<t.children.length;i++)r=t.children[i],n=new c(o-r.Size.width,a),this.arrange(r,n),a+=r.Size.height+this.options.verticalSeparation;break;default:throw"Unsupported TreeDirection"}break;case"Right":switch(t.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(l=e,t.x=l.x,t.y=l.y,t.BoundingRectangle=new h(t.x,t.y,t.width,t.height),o=e.x+g+this.options.underneathHorizontalOffset,a=e.y+f+this.options.underneathVerticalTopOffset,i=0;i<t.children.length;i++)r=t.children[i],n=new c(o,a),this.arrange(r,n),a+=r.Size.height+this.options.underneathVerticalSeparation;break;case"Default":for(l=new c(e.x,e.y+(t.Size.height-f)/2),t.x=l.x,t.y=l.y,t.BoundingRectangle=new h(t.x,t.y,t.width,t.height),o=e.x+g+this.options.horizontalSeparation,a=e.y,i=0;i<t.children.length;i++)r=t.children[i],n=new c(o,a),this.arrange(r,n),a+=r.Size.height+this.options.verticalSeparation;break;default:throw"Unsupported TreeDirection"}break;case"Up":if(l=new c(e.x+(t.Size.width-g)/2,e.y+t.Size.height-f),t.x=l.x,t.y=l.y,t.BoundingRectangle=new h(t.x,t.y,t.width,t.height),Math.abs(l.x-e.x)<p){for(s=0,i=0;i<t.children.length;i++)s+=t.children[i].Size.width+this.options.horizontalSeparation;s-=this.options.horizontalSeparation,o=e.x+(g-s)/2}else o=e.x;for(i=0;i<t.children.length;i++)r=t.children[i],a=l.y-this.options.verticalSeparation-r.Size.height,n=new c(o,a),this.arrange(r,n),o+=r.Size.width+this.options.horizontalSeparation;break;case"Down":switch(t.childrenLayout){case"TopAlignedWithParent":case"BottomAlignedWithParent":break;case"Underneath":for(l=e,t.x=l.x,t.y=l.y,t.BoundingRectangle=new h(t.x,t.y,t.width,t.height),o=e.x+this.options.underneathHorizontalOffset,a=e.y+f+this.options.underneathVerticalTopOffset,i=0;i<t.children.length;i++)r=t.children[i],n=new c(o,a),this.arrange(r,n),a+=r.Size.height+this.options.underneathVerticalSeparation;break;case"Default":if(l=new c(e.x+(t.Size.width-g)/2,e.y),t.x=l.x,t.y=l.y,t.BoundingRectangle=new h(t.x,t.y,t.width,t.height),Math.abs(l.x-e.x)<p){for(s=0,i=0;i<t.children.length;i++)s+=t.children[i].Size.width+this.options.horizontalSeparation;s-=this.options.horizontalSeparation,o=e.x+(g-s)/2}else o=e.x;for(i=0;i<t.children.length;i++)r=t.children[i],a=l.y+this.options.verticalSeparation+f,n=new c(o,a),this.arrange(r,n),o+=r.Size.width+this.options.horizontalSeparation;break;default:throw"Unsupported TreeDirection"}break;case"None":break;default:throw"Unsupported TreeDirection"}},layoutSwitch:function(){if(this.center&&!u.isEmpty(this.center.children)){var t,e,i,n,r=this.options.subtype;u.isUndefined(r)&&(r="Down");var s=this.center.children;switch(r.toLowerCase()){case"radial":case"radialtree":this.layoutRadialTree();break;case"mindmaphorizontal":case"mindmap":t=this.center.children,1===this.center.children.length?this.layoutRight(t):(n=s.length/2,e=v(this.center.children,(function(t){return u.indexOf(s,t)<n})),i=v(this.center.children,(function(t){return u.indexOf(s,t)>=n})),this.layoutLeft(e),this.layoutRight(i));break;case"mindmapvertical":t=this.center.children,1===this.center.children.length?this.layoutDown(t):(n=s.length/2,e=v(this.center.children,(function(t){return u.indexOf(s,t)<n})),i=v(this.center.children,(function(t){return u.indexOf(s,t)>=n})),this.layoutUp(e),this.layoutDown(i));break;case"right":this.layoutRight(this.center.children);break;case"left":this.layoutLeft(this.center.children);break;case"up":case"bottom":this.layoutUp(this.center.children);break;case"down":case"top":this.layoutDown(this.center.children);break;case"tipover":case"tipovertree":if(this.options.tipOverTreeStartLevel<0)throw"The tip-over level should be a positive integer.";this.tipOverTree(this.center.children,this.options.tipOverTreeStartLevel)}}}}),S=m.extend({init:function(t){if(m.fn.init.call(this),u.isUndefined(t))throw"No diagram specified.";this.diagram=t},layout:function(t){this.transferOptions(t);var e=new w(this.diagram);this.graph=e.convert();var n=this.layoutComponents();return new i.LayoutState(this.diagram,n)},layoutComponents:function(){if(!this.graph.isEmpty()){var t=this.graph.getConnectedComponents();if(!u.isEmpty(t)){for(var e=new C(this.options),i=[],n=0;n<t.length;n++){var r=t[n],s=this.getTree(r);if(!s)throw"Failed to find a spanning tree for the component.";var o=s.root,a=s.tree;e.layout(a,o),i.push(a)}return this.gridLayoutComponents(i)}}},getTree:function(t){var e=null;if(this.options.roots&&this.options.roots.length>0)for(var i=0,n=t.nodes.length;i<n;i++)for(var r=t.nodes[i],s=0;s<this.options.roots.length;s++)if(this.options.roots[s]===r.associatedShape){e=r;break}if(!e&&!(e=t.root()))throw"Unable to find a root for the tree.";return this.getTreeForRoot(t,e)},getTreeForRoot:function(t,e){var i=t.getSpanningTree(e);return u.isUndefined(i)||i.isEmpty()?null:{tree:i,root:i.root}}}),D=m.extend({init:function(t){if(m.fn.init.call(this),u.isUndefined(t))throw"Diagram is not specified.";this.diagram=t},layout:function(t){this.transferOptions(t);var e=new w(this.diagram).convert(t);if(!e.isEmpty()){var n=e.getConnectedComponents();if(!u.isEmpty(n)){for(var r=0;r<n.length;r++){var s=n[r];this.layoutGraph(s,t)}var o=this.gridLayoutComponents(n);return new i.LayoutState(this.diagram,o)}}},_initRuntimeProperties:function(){for(var t=0;t<this.graph.nodes.length;t++){var e=this.graph.nodes[t];e.layer=-1,e.downstreamLinkCount=0,e.upstreamLinkCount=0,e.isVirtual=!1,e.uBaryCenter=0,e.dBaryCenter=0,e.upstreamPriority=0,e.downstreamPriority=0,e.gridPosition=0}},_prepare:function(t){var e,i,n,r,s,o,a=[],h=new l,d=0;for(u.forEach(t.nodes,(function(t){0===t.incoming.length&&(h.set(t,0),a.push(t))}));a.length>0;)for(s=a.shift(),e=0;e<s.outgoing.length;e++)o=(n=s.outgoing[e]).target,r=h.containsKey(o)?Math.max(h.get(s)+1,h.get(o)):h.get(s)+1,h.set(o,r),r>d&&(d=r),y(a,o)||a.push(o);var g,c=h.keys();c.sort((function(t,e){var i=h.get(t),n=h.get(e);return u.sign(n-i)}));for(var p=0;p<c.length;++p){var f=c[p],v=Number.MAX_VALUE;if(0!==f.outgoing.length){for(i=0;i<f.outgoing.length;++i)n=f.outgoing[i],v=Math.min(v,h.get(n.target));v>1&&h.set(f,v-1)}}for(this.layers=[],e=0;e<d+1;e++)(g=[]).linksTo={},this.layers.push(g);for(h.forEach((function(t,e){t.layer=e,this.layers[e].push(t)}),this),i=0;i<this.layers.length;i++)for(g=this.layers[i],e=0;e<g.length;e++)g[e].gridPosition=e},layoutGraph:function(t,e){if(u.isUndefined(t))throw"No graph given or graph analysis of the diagram failed.";u.isDefined(e)&&this.transferOptions(e),this.graph=t,t.setItemIndices();var i=t.makeAcyclic();this._initRuntimeProperties(),this._prepare(t,e),this._dummify(),this._optimizeCrossings(),this._swapPairs(),this.arrangeNodes(),this._moveThingsAround(),this._dedummify(),u.forEach(i,(function(t){t.points&&t.points.reverse()}))},setMinDist:function(t,e,i){var n=t.layer,r=t.layerIndex;this.minDistances[n][r]=i},getMinDist:function(t,e){for(var i=0,n=t.layerIndex,r=e.layerIndex,s=t.layer,o=Math.min(n,r),a=Math.max(n,r),h=o;h<a;++h)i+=this.minDistances[s][h];return i},placeLeftToRight:function(t){for(var e,i,n=new l,r=0;r<this.layers.length;++r){var s=t[r];if(s){for(e=0;e<s.length;e++)i=s[e],n.containsKey(i)||this.placeLeft(i,n,r);var o=Number.POSITIVE_INFINITY;for(e=0;e<s.length;e++){i=s[e];var a=this.rightSibling(i);a&&this.nodeLeftClass.get(a)!==r&&(o=Math.min(o,n.get(a)-n.get(i)-this.getMinDist(i,a)))}if(o===Number.POSITIVE_INFINITY){var h=[];for(e=0;e<s.length;e++){i=s[e];var d=[];u.addRange(d,this.upNodes.get(i)),u.addRange(d,this.downNodes.get(i));for(var g=0;g<d.length;g++){var c=d[g];this.nodeLeftClass.get(c)<r&&h.push(n.get(c)-n.get(i))}}h.sort(),o=0===h.length?0:h.length%2==1?h[this.intDiv(h.length,2)]:(h[this.intDiv(h.length,2)-1]+h[this.intDiv(h.length,2)])/2}for(e=0;e<s.length;e++)i=s[e],n.set(i,n.get(i)+o)}}return n},placeRightToLeft:function(t){for(var e,i,n=new l,r=0;r<this.layers.length;++r){var s=t[r];if(s){for(e=0;e<s.length;e++)i=s[e],n.containsKey(i)||this.placeRight(i,n,r);var o=Number.NEGATIVE_INFINITY;for(e=0;e<s.length;e++){i=s[e];var a=this.leftSibling(i);a&&this.nodeRightClass.get(a)!==r&&(o=Math.max(o,n.get(a)-n.get(i)+this.getMinDist(a,i)))}if(o===Number.NEGATIVE_INFINITY){var h=[];for(e=0;e<s.length;e++){i=s[e];var d=[];u.addRange(d,this.upNodes.get(i)),u.addRange(d,this.downNodes.get(i));for(var g=0;g<d.length;g++){var c=d[g];this.nodeRightClass.get(c)<r&&h.push(n.get(i)-n.get(c))}}h.sort(),o=0===h.length?0:h.length%2==1?h[this.intDiv(h.length,2)]:(h[this.intDiv(h.length,2)-1]+h[this.intDiv(h.length,2)])/2}for(e=0;e<s.length;e++)i=s[e],n.set(i,n.get(i)+o)}}return n},_getLeftWing:function(){var t={value:null},e=this.computeClasses(t,1);return this.nodeLeftClass=t.value,e},_getRightWing:function(){var t={value:null},e=this.computeClasses(t,-1);return this.nodeRightClass=t.value,e},computeClasses:function(t,e){for(var i=0,n=t.value=new l,r=0;r<this.layers.length;++r){i=r;for(var s=this.layers[r],o=1===e?0:s.length-1;0<=o&&o<s.length;o+=e){var a=s[o];if(n.containsKey(a))i=n.get(a);else if(n.set(a,i),a.isVirtual)for(var h=this._nodesInLink(a),d=0;d<h.length;d++){var g=h[d];n.set(g,i)}}}for(var u=[],c=0;c<this.layers.length;c++)u.push(null);return n.forEach((function(t,e){null===u[e]&&(u[e]=[]),u[e].push(t)})),u},_isVerticalLayout:function(){return"up"===this.options.subtype.toLowerCase()||"down"===this.options.subtype.toLowerCase()||"vertical"===this.options.subtype.toLowerCase()},_isHorizontalLayout:function(){return"right"===this.options.subtype.toLowerCase()||"left"===this.options.subtype.toLowerCase()||"horizontal"===this.options.subtype.toLowerCase()},_isIncreasingLayout:function(){return"right"===this.options.subtype.toLowerCase()||"down"===this.options.subtype.toLowerCase()},_moveThingsAround:function(){var t,e,i,n,r,s;for(e=0;e<this.layers.length;++e)(n=this.layers[e]).sort(this._gridPositionComparer);for(this.minDistances=[],e=0;e<this.layers.length;++e)for(n=this.layers[e],this.minDistances[e]=[],r=0;r<n.length;++r)(i=n[r]).layerIndex=r,this.minDistances[e][r]=this.options.nodeDistance,r<n.length-1&&(this._isVerticalLayout()?this.minDistances[e][r]+=(i.width+n[r+1].width)/2:this.minDistances[e][r]+=(i.height+n[r+1].height)/2);for(this.downNodes=new l,this.upNodes=new l,u.forEach(this.graph.nodes,(function(t){this.downNodes.set(t,[]),this.upNodes.set(t,[])}),this),u.forEach(this.graph.links,(function(t){var e=t.source,i=t.target,n=null,r=null;e.layer>i.layer?(n=t.source,r=t.target):(r=t.source,n=t.target),this.downNodes.get(r).push(n),this.upNodes.get(n).push(r)}),this),this.downNodes.forEachValue((function(t){t.sort(this._gridPositionComparer)}),this),this.upNodes.forEachValue((function(t){t.sort(this._gridPositionComparer)}),this),e=0;e<this.layers.length-1;++e)for(n=this.layers[e],s=0;s<n.length-1;s++){var o=n[s];if(o.isVirtual){var a=this.downNodes.get(o)[0];if(a.isVirtual)for(r=s+1;r<n.length;++r)if((i=n[r]).isVirtual){var h=this.downNodes.get(i)[0];if(h.isVirtual&&a.gridPosition>h.gridPosition){var d=a.gridPosition;a.gridPosition=h.gridPosition,h.gridPosition=d;var g=a.layerIndex,c=h.layerIndex;this.layers[e+1][g]=h,this.layers[e+1][c]=a,a.layerIndex=c,h.layerIndex=g}}}}var p=this._getLeftWing(),f=this._getRightWing(),y=this.placeLeftToRight(p),v=this.placeRightToLeft(f),m=new l;u.forEach(this.graph.nodes,(function(t){m.set(t,(y.get(t)+v.get(t))/2)}));var w=new l,x=new l;for(e=0;e<this.layers.length;++e){n=this.layers[e];var C=-1;for(r=0;r<n.length;++r)i=n[r],w.set(i,0),x.set(i,!1),i.isVirtual&&(-1===C||C===r-1||(w.set(n[C],0),m.get(i)-m.get(n[C])===this.getMinDist(n[C],i)?x.set(n[C],!0):x.set(n[C],!1)),C=r)}u.forEach([1,-1],(function(e){for(var i=1===e?0:this.layers.length-1;0<=i&&i<this.layers.length;i+=e){var n=this.layers[i],r=this._firstVirtualNode(n),s=null,o=null;if(-1!==r)for(s=n[r],o=[],t=0;t<r;t++)o.push(n[t]);else s=null,o=n;if(o.length>0){for(this._sequencer(m,null,s,e,o),t=0;t<o.length-1;++t)this.setMinDist(o[t],o[t+1],m.get(o[t+1])-m.get(o[t]));s&&this.setMinDist(o[o.length-1],s,m.get(s)-m.get(o[o.length-1]))}for(;s;){var a=this.nextVirtualNode(n,s);if(a){if(w.get(s)===e){r=s.layerIndex;var h=a.layerIndex;for(o=[],t=r+1;t<h;t++)o.push(n[t]);o.length>0&&this._sequencer(m,s,a,e,o),x.set(s,!0)}}else{for(r=s.layerIndex,o=[],t=r+1;t<n.length;t++)o.push(n[t]);if(o.length>0){for(this._sequencer(m,s,null,e,o),t=0;t<o.length-1;++t)this.setMinDist(o[t],o[t+1],m.get(o[t+1])-m.get(o[t]));this.setMinDist(s,o[0],m.get(o[0])-m.get(s))}}s=a}this.adjustDirections(i,e,w,x)}}),this);var S,D,M=this._isIncreasingLayout()?0:this.layers.length-1,L=this._isIncreasingLayout()?1:-1,k=0;function b(t,e){for(var i=Number.MIN_VALUE,n=0;n<t.length;++n){var r=t[n];i=e._isVerticalLayout()?Math.max(i,r.height):Math.max(i,r.width)}return i}for(t=M;S=t,(D=this)._isIncreasingLayout()?S<D.layers.length:S>=0;t+=L){var P=b(n=this.layers[t],this);for(r=0;r<n.length;++r)i=n[r],this._isVerticalLayout()?(i.x=m.get(i),i.y=k+P/2):(i.x=k+P/2,i.y=m.get(i));k+=this.options.layerSeparation+P}},adjustDirections:function(t,e,i,n){if(!(t+e<0||t+e>=this.layers.length))for(var r=null,s=null,o=this.layers[t+e],a=0;a<o.length;++a){var h=o[a];if(h.isVirtual){var l=this.getNeighborOnLayer(h,t);if(l.isVirtual){if(r){for(var d=n.get(s),g=this.layers[t],u=s.layerIndex,c=l.layerIndex,p=u+1;p<c;++p)g[p].isVirtual&&(d=d&&n.get(g[p]));if(d){i.set(r,e);for(var f=r.layerIndex,y=h.layerIndex,v=f+1;v<y;++v)o[v].isVirtual&&i.set(o[v],e)}}r=h,s=l}}}},getNeighborOnLayer:function(t,e){var i=this.upNodes.get(t)[0];return i.layer===e||(i=this.downNodes.get(t)[0]).layer===e?i:null},_sequencer:function(t,e,i,n,r){if(1===r.length&&this._sequenceSingle(t,e,i,n,r[0]),r.length>1){var s=r.length,o=this.intDiv(s,2);this._sequencer(t,e,i,n,r.slice(0,o)),this._sequencer(t,e,i,n,r.slice(o)),this.combineSequences(t,e,i,n,r)}},_sequenceSingle:function(t,e,i,n,r){var s=-1===n?this.downNodes.get(r):this.upNodes.get(r),o=s.length;0!==o&&(o%2==1?t.set(r,t.get(s[this.intDiv(o,2)])):t.set(r,(t.get(s[this.intDiv(o,2)-1])+t.get(s[this.intDiv(o,2)]))/2),e&&t.set(r,Math.max(t.get(r),t.get(e)+this.getMinDist(e,r))),i&&t.set(r,Math.min(t.get(r),t.get(i)-this.getMinDist(r,i))))},combineSequences:function(t,e,i,n,r){var s,o,a,h,l,d,g=r.length,u=this.intDiv(g,2),c=[];for(s=0;s<u;++s){for(o=0,h=-1===n?this.downNodes.get(r[s]):this.upNodes.get(r[s]),a=0;a<h.length;++a)l=h[a],t.get(l)>=t.get(r[s])?o++:(o--,c.push({k:t.get(l)+this.getMinDist(r[s],r[u-1]),v:2}));c.push({k:t.get(r[s])+this.getMinDist(r[s],r[u-1]),v:o})}e&&c.push({k:t.get(e)+this.getMinDist(e,r[u-1]),v:Number.MAX_VALUE}),c.sort(this._positionDescendingComparer);var p=[];for(s=u;s<g;++s){for(o=0,h=-1===n?this.downNodes.get(r[s]):this.upNodes.get(r[s]),a=0;a<h.length;++a)l=h[a],t.get(l)<=t.get(r[s])?o++:(o--,p.push({k:t.get(l)-this.getMinDist(r[s],r[u]),v:2}));p.push({k:t.get(r[s])-this.getMinDist(r[s],r[u]),v:o})}i&&p.push({k:t.get(i)-this.getMinDist(i,r[u]),v:Number.MAX_VALUE}),p.sort(this._positionAscendingComparer);for(var f=0,y=0,v=this.getMinDist(r[u-1],r[u]);t.get(r[u])-t.get(r[u-1])<v;)if(f<y){if(0===c.length){t.set(r[u-1],t.get(r[u])-v);break}f+=(d=c.shift()).v,t.set(r[u-1],d.k),t.set(r[u-1],Math.max(t.get(r[u-1]),t.get(r[u])-v))}else{if(0===p.length){t.set(r[u],t.get(r[u-1])+v);break}y+=(d=p.shift()).v,t.set(r[u],d.k),t.set(r[u],Math.min(t.get(r[u]),t.get(r[u-1])+v))}for(s=u-2;s>=0;s--)t.set(r[s],Math.min(t.get(r[s]),t.get(r[u-1])-this.getMinDist(r[s],r[u-1])));for(s=u+1;s<g;s++)t.set(r[s],Math.max(t.get(r[s]),t.get(r[u])+this.getMinDist(r[s],r[u])))},placeLeft:function(t,e,i){var n=Number.NEGATIVE_INFINITY;u.forEach(this._getComposite(t),(function(t){var r=this.leftSibling(t);r&&this.nodeLeftClass.get(r)===this.nodeLeftClass.get(t)&&(e.containsKey(r)||this.placeLeft(r,e,i),n=Math.max(n,e.get(r)+this.getMinDist(r,t)))}),this),n===Number.NEGATIVE_INFINITY&&(n=0),u.forEach(this._getComposite(t),(function(t){e.set(t,n)}))},placeRight:function(t,e,i){var n=Number.POSITIVE_INFINITY;u.forEach(this._getComposite(t),(function(t){var r=this.rightSibling(t);r&&this.nodeRightClass.get(r)===this.nodeRightClass.get(t)&&(e.containsKey(r)||this.placeRight(r,e,i),n=Math.min(n,e.get(r)-this.getMinDist(t,r)))}),this),n===Number.POSITIVE_INFINITY&&(n=0),u.forEach(this._getComposite(t),(function(t){e.set(t,n)}))},leftSibling:function(t){var e=this.layers[t.layer],i=t.layerIndex;return 0===i?null:e[i-1]},rightSibling:function(t){var e=this.layers[t.layer],i=t.layerIndex;return i===e.length-1?null:e[i+1]},_getComposite:function(t){return t.isVirtual?this._nodesInLink(t):[t]},arrangeNodes:function(){var t,e,i,n,r;for(e=0;e<this.layers.length;e++)for(n=this.layers[e],i=0;i<n.length;i++)(r=n[i]).upstreamPriority=r.upstreamLinkCount,r.downstreamPriority=r.downstreamLinkCount;for(var s=0;s<2;s++){for(t=this.layers.length-1;t>=1;t--)this.layoutLayer(!1,t);for(t=0;t<this.layers.length-1;t++)this.layoutLayer(!0,t)}var o=Number.MAX_VALUE;for(e=0;e<this.layers.length;e++)for(n=this.layers[e],i=0;i<n.length;i++)r=n[i],o=Math.min(o,r.gridPosition);if(o<0)for(e=0;e<this.layers.length;e++)for(n=this.layers[e],i=0;i<n.length;i++)(r=n[i]).gridPosition=r.gridPosition-o},layoutLayer:function(t,e){var i,n;n=t?this.layers[i=e+1]:this.layers[i=e-1];for(var r=[],s=0;s<n.length;s++)r.push(n[s]);r.sort((function(t,e){var i=(t.upstreamPriority+t.downstreamPriority)/2,n=(e.upstreamPriority+e.downstreamPriority)/2;return Math.abs(i-n)<1e-4?0:i<n?1:-1})),u.forEach(r,(function(t){var e=t.gridPosition,i=this.calcBaryCenter(t),r=(t.upstreamPriority+t.downstreamPriority)/2;if(!(Math.abs(e-i)<1e-4||Math.abs(e-i)<.2501))if(e<i)for(;e<i&&this.moveRight(t,n,r);)e=t.gridPosition;else for(;e>i&&this.moveLeft(t,n,r);)e=t.gridPosition}),this),i>0&&this.calcDownData(i-1),i<this.layers.length-1&&this.calcUpData(i+1)},moveRight:function(t,e,i){var n=u.indexOf(e,t);if(n===e.length-1)return t.gridPosition=t.gridPosition+.5,!0;var r=e[n+1],s=(r.upstreamPriority+r.downstreamPriority)/2;return r.gridPosition>t.gridPosition+1?(t.gridPosition=t.gridPosition+.5,!0):!(s>i||Math.abs(s-i)<1e-4||!this.moveRight(r,e,i)||(t.gridPosition=t.gridPosition+.5,0))},moveLeft:function(t,e,i){var n=u.indexOf(e,t);if(0===n)return t.gridPosition=t.gridPosition-.5,!0;var r=e[n-1],s=(r.upstreamPriority+r.downstreamPriority)/2;return r.gridPosition<t.gridPosition-1?(t.gridPosition=t.gridPosition-.5,!0):!(s>i||Math.abs(s-i)<1e-4||!this.moveLeft(r,e,i)||(t.gridPosition=t.gridPosition-.5,0))},mapVirtualNode:function(t,e){this.nodeToLinkMap.set(t,e),this.linkToNodeMap.containsKey(e)||this.linkToNodeMap.set(e,[]),this.linkToNodeMap.get(e).push(t)},_nodesInLink:function(t){return this.linkToNodeMap.get(this.nodeToLinkMap.get(t))},_dummify:function(){this.linkToNodeMap=new l,this.nodeToLinkMap=new l;var t,e,i,n,o,a,h,d,g=this.graph.links.slice(0),c=this.layers,p=function(t,e,i){c[t].linksTo[e]=c[t].linksTo[e]||[],c[t].linksTo[e].push(i)};for(d=0;d<g.length;d++){var f=g[d],y=f.source,v=f.target,m=y.layer,w=v.layer,x=y.gridPosition,C=v.gridPosition,S=(C-x)/Math.abs(w-m),D=y;if(m-w>1){for(h=m-1;h>w;h--){for((i=new r).x=y.x,i.y=y.y,i.width=y.width/100,i.height=y.height/100,(e=(h-w)*S+x)>(t=c[h]).length&&(e=t.length),x>=c[m].length-1&&C>=c[w].length-1?e=t.length:0===x&&0===C&&(e=0),i.layer=h,i.uBaryCenter=0,i.dBaryCenter=0,i.upstreamLinkCount=0,i.downstreamLinkCount=0,i.gridPosition=e,i.isVirtual=!0,u.insert(t,i,e),o=e+1;o<t.length;o++)(n=t[o]).gridPosition=n.gridPosition+1;(a=new s(D,i)).depthOfDumminess=0,p(h-1,h,a),D=i,this.graph._addNode(i),this.graph.addLink(a),i.index=this.graph.nodes.length-1,this.mapVirtualNode(i,f)}p(w-1,w,a),f.changeSource(D),f.depthOfDumminess=m-w-1}else if(m-w<-1){for(h=m+1;h<w;h++){for((i=new r).x=y.x,i.y=y.y,i.width=y.width/100,i.height=y.height/100,(e=(h-m)*S+x)>(t=c[h]).length&&(e=t.length),x>=c[m].length-1&&C>=c[w].length-1?e=t.length:0===x&&0===C&&(e=0),i.layer=h,i.uBaryCenter=0,i.dBaryCenter=0,i.upstreamLinkCount=0,i.downstreamLinkCount=0,i.gridPosition=e,i.isVirtual=!0,e&=e,u.insert(t,i,e),o=e+1;o<t.length;o++)(n=t[o]).gridPosition=n.gridPosition+1;(a=new s(D,i)).depthOfDumminess=0,p(h-1,h,a),D=i,this.graph._addNode(i),this.graph.addLink(a),i.index=this.graph.nodes.length-1,this.mapVirtualNode(i,f)}p(w-1,w,f),f.changeSource(D),f.depthOfDumminess=w-m-1}else p(m,w,f)}},_dedummify:function(){for(var t=!0;t;){t=!1;for(var e=0;e<this.graph.links.length;e++){var i=this.graph.links[e];if(i.depthOfDumminess){var n=[];n.unshift({x:i.target.x,y:i.target.y}),n.unshift({x:i.source.x,y:i.source.y});for(var r=i,s=i.depthOfDumminess,o=0;o<s;o++){var a=r.source.incoming[0];n.unshift({x:a.source.x,y:a.source.y}),r=a}i.changeSource(r.source),i.depthOfDumminess=0,n.length>2?(n.splice(0,1),n.splice(n.length-1),i.points=n):i.points=[],t=!0;break}}}},_optimizeCrossings:function(){for(var t,e=-1,i=0;0!==e&&!(i++>3);){for(e=0,t=this.layers.length-1;t>=1;t--)e+=this.optimizeLayerCrossings(!1,t);for(t=0;t<this.layers.length-1;t++)e+=this.optimizeLayerCrossings(!0,t)}},calcUpData:function(t){if(0!==t){var e,i,n,r=this.layers[t],s=new d,o=this.layers[t-1];for(e=0;e<o.length;e++)s.add(o[e]);for(e=0;e<r.length;e++){var a=r[e],h=0,l=0;for(i=0;i<a.incoming.length;i++)n=a.incoming[i],s.contains(n.source)&&(l++,h+=n.source.gridPosition);for(i=0;i<a.outgoing.length;i++)n=a.outgoing[i],s.contains(n.target)&&(l++,h+=n.target.gridPosition);l>0?(a.uBaryCenter=h/l,a.upstreamLinkCount=l):(a.uBaryCenter=e,a.upstreamLinkCount=0)}}},calcDownData:function(t){if(t!==this.layers.length-1){var e,i,n,r=this.layers[t],s=new d,o=this.layers[t+1];for(e=0;e<o.length;e++)s.add(o[e]);for(e=0;e<r.length;e++){var a=r[e],h=0,l=0;for(i=0;i<a.incoming.length;i++)n=a.incoming[i],s.contains(n.source)&&(l++,h+=n.source.gridPosition);for(i=0;i<a.outgoing.length;i++)n=a.outgoing[i],s.contains(n.target)&&(l++,h+=n.target.gridPosition);l>0?(a.dBaryCenter=h/l,a.downstreamLinkCount=l):(a.dBaryCenter=e,a.downstreamLinkCount=0)}}},optimizeLayerCrossings:function(t,e){var i,n,r=(n=t?this.layers[i=e+1]:this.layers[i=e-1]).slice(0);t?this.calcUpData(i):this.calcDownData(i);var s=this;n.sort((function(t,e){var i=s.calcBaryCenter(t),n=s.calcBaryCenter(e);if(Math.abs(i-n)<1e-4)return t.degree()===e.degree()?s.compareByIndex(t,e):t.degree()<e.degree()?1:-1;var r=1e3*(n-i);return r>0?-1:r<0?1:s.compareByIndex(t,e)}));var o,a=0;for(o=0;o<n.length;o++)n[o]!==r[o]&&a++;if(a>0){var h=0;for(o=0;o<n.length;o++)n[o].gridPosition=h++}return a},_swapPairs:function(){for(var t=this.options.layeredIterations,e=0;!(e++>t);)for(var i=e%4<=1,n=e%4==1,r=i?0:this.layers.length-1;i?r<=this.layers.length-1:r>=0;r+=i?1:-1){for(var s=this.layers[r],o=!1,a=!0,h=0,l=0;l<s.length-1;l++){var d=0,g=0,u=0;if(a?(0!==r&&(d=this.countLinksCrossingBetweenTwoLayers(r-1,r)),r!==this.layers.length-1&&(g=this.countLinksCrossingBetweenTwoLayers(r,r+1)),i?d*=2:g*=2,u=d+g):u=h,0!==u){var c=s[l],p=s[l+1],f=c.gridPosition,y=p.gridPosition;s[l]=p,s[l+1]=c,c.gridPosition=y,p.gridPosition=f,d=0,0!==r&&(d=this.countLinksCrossingBetweenTwoLayers(r-1,r)),g=0,r!==this.layers.length-1&&(g=this.countLinksCrossingBetweenTwoLayers(r,r+1)),i?d*=2:g*=2;var v=d+g;(n?v>=u:v>u)?(c=s[l],p=s[l+1],f=c.gridPosition,y=p.gridPosition,s[l]=p,s[l+1]=c,c.gridPosition=y,p.gridPosition=f,h=u,a=!1):(o=!0,a=!0)}}o&&(r!==this.layers.length-1&&this.calcUpData(r+1),0!==r&&this.calcDownData(r-1))}},countLinksCrossingBetweenTwoLayers:function(t,e){var i,n,r,s,o,a,h,l,d=this.layers[t].linksTo[e],g=0,u=d.length;for(h=0;h<u;h++)for(i=d[h],l=h+1;l<u;l++){n=d[l],i.target.layer===e?(r=i.source,s=i.target):(r=i.target,s=i.source),n.target.layer===e?(o=n.source,a=n.target):(o=n.target,a=n.source);var c=r.gridPosition,p=s.gridPosition;(c-o.gridPosition)*(p-a.gridPosition)<0&&g++}return g},calcBaryCenter:function(t){var e=t.upstreamLinkCount,i=t.downstreamLinkCount,n=t.uBaryCenter,r=t.dBaryCenter;return e>0&&i>0?(n+r)/2:e>0?n:i>0?r:0},_gridPositionComparer:function(t,e){return t.gridPosition<e.gridPosition?-1:t.gridPosition>e.gridPosition?1:0},_positionAscendingComparer:function(t,e){return t.k<e.k?-1:t.k>e.k?1:0},_positionDescendingComparer:function(t,e){return t.k<e.k?1:t.k>e.k?-1:0},_firstVirtualNode:function(t){for(var e=0;e<t.length;e++)if(t[e].isVirtual)return e;return-1},compareByIndex:function(t,e){var i=t.index,n=e.index;return i<n?1:i>n?-1:0},intDiv:function(t,e){return(t-t%e)/e},nextVirtualNode:function(t,e){for(var i=e.layerIndex+1;i<t.length;++i)if(t[i].isVirtual)return t[i];return null}}),M=e.Class.extend({init:function(t,e){if(u.isUndefined(t))throw"No diagram given";this.diagram=t,this.nodeMap=new l,this.linkMap=new l,this.capture(e||t)},capture:function(t){var e,n,r,s,o,a,l;if(t instanceof i.Graph){for(s=0;s<t.nodes.length;s++)r=(e=t.nodes[s]).associatedShape,this.nodeMap.set(r.visual.id,new h(e.x,e.y,e.width,e.height));for(s=0;s<t.links.length;s++)o=(a=t.links[s]).associatedConnection,this.linkMap.set(o.visual.id,a.points())}else if(t instanceof Array)for(n=t,s=0;s<n.length;s++)(r=(e=n[s]).associatedShape)&&this.nodeMap.set(r.visual.id,new h(e.x,e.y,e.width,e.height));else if(t.hasOwnProperty("links")&&t.hasOwnProperty("nodes")){for(n=t.nodes,l=t.links,s=0;s<n.length;s++)(r=(e=n[s]).associatedShape)&&this.nodeMap.set(r.visual.id,new h(e.x,e.y,e.width,e.height));for(s=0;s<l.length;s++)(o=(a=l[s]).associatedConnection)&&this.linkMap.set(o.visual.id,a.points)}else{var d=this.diagram.shapes,g=this.diagram.connections;for(s=0;s<d.length;s++)r=d[s],this.nodeMap.set(r.visual.id,r.bounds());for(s=0;s<g.length;s++)o=g[s],this.linkMap.set(o.visual.id,o.points())}}}),o(i,{init:function(t){e.init(t,i.ui)},SpringLayout:x,TreeLayout:S,GraphAdapter:w,LayeredLayout:D,LayoutBase:m,LayoutState:M})})?n.apply(e,r):n)||(t.exports=s)},902:function(t,e){t.exports=i(4965)}})}}]);